{"version":3,"file":"pixpipe.js","sources":["../src/PixpipeObject.js","../src/Filter.js","../src/Image.js","../src/CanvasImageWriter.js"],"sourcesContent":["/**\n* PixpipeObject is the base object of all. It creates a uuid and has few\n* generic attributes like type, name and description. Not all these attributes\n* always useful;\n*/\nclass PixpipeObject {\n\n  constructor(){\n    // unique identifier\n    this._uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n      var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);\n      return v.toString(16);\n    });\n\n    this._name = null;\n    this._description = null;\n    this._type = PixpipeObject.TYPE();\n  }\n\n\n  /**\n  * Acces it like a static attribute.\n  * Must be overloaded.\n  */\n  static TYPE(){\n    return \"GENERIC\";\n  }\n\n\n  /**\n  * Compare a give type to the type of this object.\n  * @param {String} t - a type, better to call the static method of each object, like Image.TYPE()\n  */\n  isOfType( t ){\n    return !(this._type.localeCompare(t))\n  }\n\n\n  /**\n  * Get type of object.\n  * @return {String} the type\n  */\n  getType(){\n    this._type;\n  }\n\n  /**\n  * Return a copy of the uuid\n  */\n  get uuid(){\n    return this._uuid.slice();\n  }\n\n\n  /**\n  * Setter fo the name.\n  * @param {String} n - name\n  */\n  setName( n ){\n    this._name = n;\n  }\n\n\n  /**\n  * Getter for the name\n  * @return {String} name\n  */\n  getName(){\n    return this._name;\n  }\n\n\n  /**\n  * Setter fo the description.\n  * @param {String} d - description\n  */\n  setDescription( d ){\n    this._description = d;\n  }\n\n\n  /**\n  * Getter for the description\n  * @return {String} description\n  */\n  getDescription(){\n    return this._description;\n  }\n\n\n}\n\nexport { PixpipeObject }\n","\nimport { PixpipeObject } from './PixpipeObject.js';\n\n/**\n* Filter is a base class and must be inherited to be used properly.\n* A filter takes one or more Image instances as input and returns one or more\n* instances of images as output.\n* Every filter has a addInput(), a getOutput() and a update() methods.\n* Every input and output can be arranged by category, so that internaly, a filter\n* can use and output diferent kind of data.\n*/\nclass Filter extends PixpipeObject {\n\n  constructor(){\n    super();\n    this._type = Filter.TYPE();\n\n    this._isInputValid = false;\n\n    this._input = {\n      \"0\": []\n    };\n\n    this._output = {\n      \"0\" : []\n    };\n\n  }\n\n\n  /**\n  * Hardcode the datatype\n  */\n  static TYPE(){\n    return \"FILTER\";\n  }\n\n  /**\n  * Set an input, potentially associated to a category.\n  * @param {Image} imageObject - instance of an image\n  * @param {Number}\n  */\n  addInput( imageObject, category=0){\n\n    if(category < 0 ){\n      console.warn(\"A input cannot be of category inferior to zero\");\n      return;\n    }\n\n    // the category may not exist, we create it\n    if( !(category in this._input) ){\n      this._input[category] = [];\n    }\n\n    this._input[category].push( imageObject )\n  }\n\n\n  /**\n  * Return outputs from a category (default category: 0)\n  * @param {Number} category - a category of output.\n  */\n  getOutput( category=0 ){\n    if( category in this._output ){\n      return this._output[ category ];\n    }else{\n      return null;\n    }\n\n  }\n\n\n  /**\n  * MUST be implemented by the class that inherit this.\n  * MUST change the value of this._isInputValid\n  */\n  validateInput(){\n    console.warn(\"The update() method has not been written, input integrity are not checked.\");\n  }\n\n\n  /**\n  * MUST be implemented by the class that inherit this.\n  * Launch the process.\n  */\n  update(){\n    console.error(\"The update() method has not been written, this filter is not valid.\");\n  }\n\n\n} /* END class Filter */\n\nexport { Filter }\n","import { PixpipeObject } from './PixpipeObject.js';\n\n/**\n* Image class is one of the few base element of Pixpipejs.\n* It is always considered to be 4 channels (RGBA) and stored as a Float32Array\n* typed array.\n*/\nclass Image extends PixpipeObject{\n\n\n  /**\n  * Constructor of an Image instance. If no options, no array is allocated.\n  * @param {Object} options - if present, must have options.width, options.height. Also options.color = [r, g, b, a] is possible but not mandatory, this sets the default color.\n  */\n  constructor( options=null ){\n    super();\n    this._type = Image.TYPE();\n\n    // a rgba stored in a Float32Array (typed array)\n    this._data = null;\n    this._width = -1;\n    this._height = -1;\n    this._componentsPerPixel = 4; // RGBA\n\n    // allocate the array if size is specified\n    if(options && \"width\" in options && \"height\" in options){\n\n      if( options.width > 0 && options.height > 0){\n        this._width = options.width;\n        this._height = options.height;\n        this._data = new Float32Array( this._width * this._height * this._componentsPerPixel );\n\n        // init the color if specified\n        if(\"color\" in options && options.color.length == 4 ){\n          var color = options.color;\n\n          for(var i=0; i<this._data.length; i+=4){\n            this._data[i] = color[0];\n            this._data[i + 1] = color[1];\n            this._data[i + 2] = color[2];\n            this._data[i + 3] = color[3];\n          }\n\n          console.log(this._data);\n        }\n      }\n    }\n\n\n  }\n\n\n  /**\n  * Hardcode the datatype\n  */\n  static TYPE(){\n    return \"IMAGE2D\";\n  }\n\n\n  /**\n  * @return {Image} a deep copy instance of this Image\n  */\n  clone(){\n    var cpImg = new Image();\n    cpImg.setData( this._data.slice(), this._width, this._height );\n    return cpImg;\n  }\n\n\n  /**\n  *  Set the data to this image.\n  * @param {Float32Array} array - 1D array of raw data stored as RGBARGBA...\n  * @param {Number} width - width of the image\n  * @param {Number} height - height of the image\n  */\n  setData( array, width, height ){\n    // do not alloz to set a new internal array\n    if( this._data ){\n      console.warn(\"Data can be set to an Image object only once. Cannot init the image.\");\n      return;\n    }\n\n    if( array.length != width*height*this._componentsPerPixel){\n      console.warn(\"The array size does not match the width and height. Cannot init the image.\");\n      return;\n    }\n\n    this._data = new Float32Array( array );\n    this._width = width;\n    this._heigth = height;\n\n  }\n\n\n  /**\n  * @return {Number}\n  */\n  getWidth(){\n    return this._width;\n  }\n\n\n  getHeight(){\n    return this._height;\n  }\n\n\n  getData(){\n    //return this._data.slice();  // return a copy\n    return this._data;  // return the actual array, editable!\n  }\n\n} /* END of class Image */\n\nexport { Image }\n","/**\n*\n*/\n\n\nimport { Image } from './Image.js';\nimport { Filter } from './Filter.js';\n\nclass CanvasImageWriter extends Filter{\n\n  /**\n  * @param {String} idOfParent - dom id of the future canvas' parent.\n  * (most likely the ID of a div)\n  */\n  constructor( idOfParent){\n    // call Filter constructor\n    super();\n\n    // so that we can flush the content\n    this._parentId = idOfParent;\n    this._canvas = null;\n    this._ctx = null;\n  }\n\n\n  /**\n  * Overloaded validation method.\n  */\n  validateInput(){\n\n    try{\n      this._isInputValid = this._input[0][0].isOfType( Image.TYPE() );\n    }catch(e){\n      this._isInputValid = false;\n      console.error(\"The input is not valid\");\n    }\n\n  }\n\n\n  /**\n  * [PRIVATE]\n  * Initialize a new canvas object\n  */\n  _init(){\n    var parentElem = document.getElementById(this._parentId);\n    while (parentElem.firstChild) {\n        parentElem.removeChild(parentElem.firstChild);\n    }\n\n    // creating a canvas element\n    this._canvas = document.createElement(\"canvas\");\n    this._canvas.style = \"image-rendering: pixelated;\";\n    this._ctx = this._canvas.getContext('2d');\n\n    // not sure this is useful since the style is \"pixelated\"\n    // (does not seem to well super well with Firefox)\n    this._ctx.imageSmoothingEnabled = true;\n    this._ctx.mozImageSmoothingEnabled = false;\n    this._ctx.webkitImageSmoothingEnabled = false;\n    this._ctx.ctxmsImageSmoothingEnabled = false;\n\n    document.getElementById(this._parentId).appendChild(this._canvas);\n  }\n\n  /**\n  * Overwrite the generic (empty) method.\n  */\n  update(){\n    this.validateInput();\n\n    // abort if invalid input\n    if(!this._isInputValid)\n      return;\n\n    // build a new canvas\n    this._init();\n\n    var image = this._input[0][0];\n\n    // resizing the canvas\n    this._canvas.width = image.getWidth();\n    this._canvas.height = image.getHeight();\n\n    var canvasImageData = this._ctx.getImageData(0, 0, this._canvas.width, this._canvas.height);\n    var canvasImageDataArray = canvasImageData.data;\n\n    // getting Image object data\n    var originalImageDataArray = image.getData();\n\n    // copying the data into the canvas array (clamped uint8)\n    originalImageDataArray.forEach( function(value, index){\n      canvasImageDataArray[index] = value;\n    });\n    this._ctx.putImageData(canvasImageData, 0, 0);\n  }\n\n\n\n\n}\n\nexport { CanvasImageWriter }\n"],"names":[],"mappings":"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"}