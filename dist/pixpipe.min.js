// Build date: 2017-0421T11:03:00

/*
* Author   Jonathan Lurie - http://me.jonahanlurie.fr
* License  MIT
* Link      https://github.com/jonathanlurie/pixpipejs
* Lab       MCIN - Montreal Neurological Institute
*/
/*
 @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js  Based on ndef.parser, by Raphael Graf(r@undefined.ch)
 http://www.undefined.ch/mparser/index.html

 Ported to JavaScript and modified by Matthew Crumley (email@matthewcrumley.com, http://silentmatt.com/)

 You are free to use and modify this code in anyway you find useful. Please leave this comment in the code
 to acknowledge its original source. If you feel like it, I enjoy hearing about projects that use my code,
 but don't feel like you have to let me know or ask permission.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.inherits=function(h,t){function u(){}u.prototype=t.prototype;h.prototype=new u;h.prototype.constructor=h;for(var w in t)if(Object.defineProperties){var z=Object.getOwnPropertyDescriptor(t,w);z&&Object.defineProperty(h,w,z)}else h[w]=t[w]};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(h,t,u){if(u.get||u.set)throw new TypeError("ES3 does not support getters and setters.");h!=Array.prototype&&h!=Object.prototype&&(h[t]=u.value)};$jscomp.getGlobal=function(h){return"undefined"!=typeof window&&window===h?h:"undefined"!=typeof global&&null!=global?global:h};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(h){return $jscomp.SYMBOL_PREFIX+(h||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.iterator;h||(h=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[h]&&$jscomp.defineProperty(Array.prototype,h,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(h){var t=0;return $jscomp.iteratorPrototype(function(){return t<h.length?{done:!1,value:h[t++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(h){$jscomp.initSymbolIterator();h={next:h};h[$jscomp.global.Symbol.iterator]=function(){return this};return h};$jscomp.iteratorFromArray=function(h,t){$jscomp.initSymbolIterator();h instanceof String&&(h+="");var u=0,w={next:function(){if(u<h.length){var z=u++;return{value:t(z,h[z]),done:!1}}w.next=function(){return{done:!0,value:void 0}};return w.next()}};w[Symbol.iterator]=function(){return w};return w};
$jscomp.polyfill=function(h,t,u,w){if(t){u=$jscomp.global;h=h.split(".");for(w=0;w<h.length-1;w++){var z=h[w];z in u||(u[z]={});u=u[z]}h=h[h.length-1];w=u[h];t=t(w);t!=w&&null!=t&&$jscomp.defineProperty(u,h,{configurable:!0,writable:!0,value:t})}};$jscomp.polyfill("Array.prototype.keys",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(h){return h})}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(h){return h?h:function(h,u,w){var t=this.length||0;0>u&&(u=Math.max(0,t+u));if(null==w||w>t)w=t;w=Number(w);0>w&&(w=Math.max(0,t+w));for(u=Number(u||0);u<w;u++)this[u]=h;return this}},"es6-impl","es3");$jscomp.polyfill("Math.log2",function(h){return h?h:function(h){return Math.log(h)/Math.LN2}},"es6-impl","es3");
$jscomp.findInternal=function(h,t,u){h instanceof String&&(h=String(h));for(var w=h.length,z=0;z<w;z++){var J=h[z];if(t.call(u,J,z,h))return{i:z,v:J}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(h){return h?h:function(h,u){return $jscomp.findInternal(this,h,u).v}},"es6-impl","es3");$jscomp.polyfill("Math.sinh",function(h){if(h)return h;var t=Math.exp;return function(h){h=Number(h);return 0===h?h:(t(h)-t(-h))/2}},"es6-impl","es3");
$jscomp.polyfill("Math.cosh",function(h){if(h)return h;var t=Math.exp;return function(h){h=Number(h);return(t(h)+t(-h))/2}},"es6-impl","es3");$jscomp.polyfill("Math.tanh",function(h){return h?h:function(h){h=Number(h);if(0===h)return h;var t=Math.exp(-2*Math.abs(h)),t=(1-t)/(1+t);return 0>h?-t:t}},"es6-impl","es3");$jscomp.polyfill("Math.asinh",function(h){return h?h:function(h){h=Number(h);if(0===h)return h;var t=Math.log(Math.abs(h)+Math.sqrt(h*h+1));return 0>h?-t:t}},"es6-impl","es3");
$jscomp.polyfill("Math.acosh",function(h){return h?h:function(h){h=Number(h);return Math.log(h+Math.sqrt(h*h-1))}},"es6-impl","es3");$jscomp.polyfill("Math.log1p",function(h){return h?h:function(h){h=Number(h);if(.25>h&&-.25<h){for(var t=h,w=1,z=h,J=0,D=1;J!=z;)t*=h,D*=-1,z=(J=z)+D*t/++w;return z}return Math.log(1+h)}},"es6-impl","es3");$jscomp.polyfill("Math.atanh",function(h){if(h)return h;var t=Math.log1p;return function(h){h=Number(h);return(t(h)-t(-h))/2}},"es6-impl","es3");
$jscomp.polyfill("Math.log10",function(h){return h?h:function(h){return Math.log(h)/Math.LN10}},"es6-impl","es3");$jscomp.polyfill("Math.trunc",function(h){return h?h:function(h){h=Number(h);if(isNaN(h)||Infinity===h||-Infinity===h||0===h)return h;var t=Math.floor(Math.abs(h));return 0>h?-t:t}},"es6-impl","es3");
$jscomp.polyfill("Math.hypot",function(h){return h?h:function(h,u,w){h=Number(h);u=Number(u);var t,J,D,G=Math.max(Math.abs(h),Math.abs(u));for(t=2;t<arguments.length;t++)G=Math.max(G,Math.abs(arguments[t]));if(1E100<G||1E-100>G){h/=G;u/=G;D=h*h+u*u;for(t=2;t<arguments.length;t++)J=Number(arguments[t])/G,D+=J*J;return Math.sqrt(D)*G}D=h*h+u*u;for(t=2;t<arguments.length;t++)J=Number(arguments[t]),D+=J*J;return Math.sqrt(D)}},"es6-impl","es3");
(function(h,t){"object"===typeof exports&&"undefined"!==typeof module?t(exports):"function"===typeof define&&define.amd?define(["exports"],t):t(h.pixpipe=h.pixpipe||{})})(this,function(h){function t(a,c){return c={exports:{}},a(c,c.exports),c.exports}function u(a){for(var c=a.length;0<=--c;)a[c]=0}function w(a,c,b,d,e){this.static_tree=a;this.extra_bits=c;this.extra_base=b;this.elems=d;this.max_length=e;this.has_stree=a&&a.length}function z(a,c){this.dyn_tree=a;this.max_code=0;this.stat_desc=c}function J(a,
c){a.pending_buf[a.pending++]=c&255;a.pending_buf[a.pending++]=c>>>8&255}function D(a,c,b){a.bi_valid>16-b?(a.bi_buf|=c<<a.bi_valid&65535,J(a,a.bi_buf),a.bi_buf=c>>16-a.bi_valid,a.bi_valid+=b-16):(a.bi_buf|=c<<a.bi_valid&65535,a.bi_valid+=b)}function G(a,c,b){D(a,b[2*c],b[2*c+1])}function Ua(a,c){var b=0;do b|=a&1,a>>>=1,b<<=1;while(0<--c);return b>>>1}function Va(a,c,b){var d=Array(16),e=0,f;for(f=1;15>=f;f++)d[f]=e=e+b[f-1]<<1;for(b=0;b<=c;b++)e=a[2*b+1],0!==e&&(a[2*b]=Ua(d[e]++,e))}function Wa(a){var c;
for(c=0;286>c;c++)a.dyn_ltree[2*c]=0;for(c=0;30>c;c++)a.dyn_dtree[2*c]=0;for(c=0;19>c;c++)a.bl_tree[2*c]=0;a.dyn_ltree[512]=1;a.opt_len=a.static_len=0;a.last_lit=a.matches=0}function Xa(a){8<a.bi_valid?J(a,a.bi_buf):0<a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf);a.bi_buf=0;a.bi_valid=0}function Ya(a,c,b,d){var e=2*c,f=2*b;return a[e]<a[f]||a[e]===a[f]&&d[c]<=d[b]}function Ga(a,c,b){for(var d=a.heap[b],e=b<<1;e<=a.heap_len;){e<a.heap_len&&Ya(c,a.heap[e+1],a.heap[e],a.depth)&&e++;if(Ya(c,d,a.heap[e],
a.depth))break;a.heap[b]=a.heap[e];b=e;e<<=1}a.heap[b]=d}function Za(a,c,b){var d,e,f=0,g,k;if(0!==a.last_lit){do d=a.pending_buf[a.d_buf+2*f]<<8|a.pending_buf[a.d_buf+2*f+1],e=a.pending_buf[a.l_buf+f],f++,0===d?G(a,e,c):(g=oa[e],G(a,g+256+1,c),k=Ha[g],0!==k&&(e-=Ia[g],D(a,e,k)),d--,g=256>d?Y[d]:Y[256+(d>>>7)],G(a,g,b),k=Aa[g],0!==k&&(d-=Ba[g],D(a,d,k)));while(f<a.last_lit)}G(a,256,c)}function Ja(a,c){var b=c.dyn_tree,d=c.stat_desc.static_tree,e=c.stat_desc.has_stree,f=c.stat_desc.elems,g,k=-1,r;
a.heap_len=0;a.heap_max=573;for(g=0;g<f;g++)0!==b[2*g]?(a.heap[++a.heap_len]=k=g,a.depth[g]=0):b[2*g+1]=0;for(;2>a.heap_len;)r=a.heap[++a.heap_len]=2>k?++k:0,b[2*r]=1,a.depth[r]=0,a.opt_len--,e&&(a.static_len-=d[2*r+1]);c.max_code=k;for(g=a.heap_len>>1;1<=g;g--)Ga(a,b,g);r=f;do g=a.heap[1],a.heap[1]=a.heap[a.heap_len--],Ga(a,b,1),d=a.heap[1],a.heap[--a.heap_max]=g,a.heap[--a.heap_max]=d,b[2*r]=b[2*g]+b[2*d],a.depth[r]=(a.depth[g]>=a.depth[d]?a.depth[g]:a.depth[d])+1,b[2*g+1]=b[2*d+1]=r,a.heap[1]=
r++,Ga(a,b,1);while(2<=a.heap_len);a.heap[--a.heap_max]=a.heap[1];g=c.dyn_tree;r=c.max_code;for(var l=c.stat_desc.static_tree,m=c.stat_desc.has_stree,h=c.stat_desc.extra_bits,B=c.stat_desc.extra_base,n=c.stat_desc.max_length,q,y,t=0,f=0;15>=f;f++)a.bl_count[f]=0;g[2*a.heap[a.heap_max]+1]=0;for(d=a.heap_max+1;573>d;d++)e=a.heap[d],f=g[2*g[2*e+1]+1]+1,f>n&&(f=n,t++),g[2*e+1]=f,e>r||(a.bl_count[f]++,q=0,e>=B&&(q=h[e-B]),y=g[2*e],a.opt_len+=y*(f+q),m&&(a.static_len+=y*(l[2*e+1]+q)));if(0!==t){do{for(f=
n-1;0===a.bl_count[f];)f--;a.bl_count[f]--;a.bl_count[f+1]+=2;a.bl_count[n]--;t-=2}while(0<t);for(f=n;0!==f;f--)for(e=a.bl_count[f];0!==e;)l=a.heap[--d],l>r||(g[2*l+1]!==f&&(a.opt_len+=(f-g[2*l+1])*g[2*l],g[2*l+1]=f),e--)}Va(b,k,a.bl_count)}function $a(a,c,b){var d,e=-1,f,g=c[1],k=0,r=7,l=4;0===g&&(r=138,l=3);c[2*(b+1)+1]=65535;for(d=0;d<=b;d++)f=g,g=c[2*(d+1)+1],++k<r&&f===g||(k<l?a.bl_tree[2*f]+=k:0!==f?(f!==e&&a.bl_tree[2*f]++,a.bl_tree[32]++):10>=k?a.bl_tree[34]++:a.bl_tree[36]++,k=0,e=f,0===
g?(r=138,l=3):f===g?(r=6,l=3):(r=7,l=4))}function ab(a,c,b){var d,e=-1,f,g=c[1],k=0,r=7,l=4;0===g&&(r=138,l=3);for(d=0;d<=b;d++)if(f=g,g=c[2*(d+1)+1],!(++k<r&&f===g)){if(k<l){do G(a,f,a.bl_tree);while(0!==--k)}else 0!==f?(f!==e&&(G(a,f,a.bl_tree),k--),G(a,16,a.bl_tree),D(a,k-3,2)):10>=k?(G(a,17,a.bl_tree),D(a,k-3,3)):(G(a,18,a.bl_tree),D(a,k-11,7));k=0;e=f;0===g?(r=138,l=3):f===g?(r=6,l=3):(r=7,l=4)}}function zb(a){var c=4093624447,b;for(b=0;31>=b;b++,c>>>=1)if(c&1&&0!==a.dyn_ltree[2*b])return 0;
if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return 1;for(b=32;256>b;b++)if(0!==a.dyn_ltree[2*b])return 1;return 0}function bb(a,c,b,d){D(a,0+(d?1:0),3);Xa(a);J(a,b);J(a,~b);A.arraySet(a.pending_buf,a.window,c,b,a.pending);a.pending+=b}function ca(a,c){a.msg=ja[c];return c}function da(a){for(var c=a.length;0<=--c;)a[c]=0}function Z(a){var c=a.state,b=c.pending;b>a.avail_out&&(b=a.avail_out);0!==b&&(A.arraySet(a.output,c.pending_buf,c.pending_out,b,a.next_out),a.next_out+=b,c.pending_out+=
b,a.total_out+=b,a.avail_out-=b,c.pending-=b,0===c.pending&&(c.pending_out=0))}function E(a,c){U._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,c);a.block_start=a.strstart;Z(a.strm)}function C(a,c){a.pending_buf[a.pending++]=c}function pa(a,c){a.pending_buf[a.pending++]=c>>>8&255;a.pending_buf[a.pending++]=c&255}function cb(a,c){var b=a.max_chain_length,d=a.strstart,e,f=a.prev_length,g=a.nice_match,k=a.strstart>a.w_size-262?a.strstart-(a.w_size-262):0,r=a.window,l=a.w_mask,
m=a.prev,h=a.strstart+258,B=r[d+f-1],n=r[d+f];a.prev_length>=a.good_match&&(b>>=2);g>a.lookahead&&(g=a.lookahead);do if(e=c,r[e+f]===n&&r[e+f-1]===B&&r[e]===r[d]&&r[++e]===r[d+1]){d+=2;for(e++;r[++d]===r[++e]&&r[++d]===r[++e]&&r[++d]===r[++e]&&r[++d]===r[++e]&&r[++d]===r[++e]&&r[++d]===r[++e]&&r[++d]===r[++e]&&r[++d]===r[++e]&&d<h;);e=258-(h-d);d=h-258;if(e>f){a.match_start=c;f=e;if(e>=g)break;B=r[d+f-1];n=r[d+f]}}while((c=m[c&l])>k&&0!==--b);return f<=a.lookahead?f:a.lookahead}function T(a){var c=
a.w_size,b,d,e,f;do{f=a.window_size-a.lookahead-a.strstart;if(a.strstart>=c+(c-262)){A.arraySet(a.window,a.window,c,c,0);a.match_start-=c;a.strstart-=c;a.block_start-=c;b=d=a.hash_size;do e=a.head[--b],a.head[b]=e>=c?e-c:0;while(--d);b=d=c;do e=a.prev[--b],a.prev[b]=e>=c?e-c:0;while(--d);f+=c}if(0===a.strm.avail_in)break;b=a.strm;d=a.window;e=a.strstart+a.lookahead;var g=b.avail_in;g>f&&(g=f);0===g?d=0:(b.avail_in-=g,A.arraySet(d,b.input,b.next_in,g,e),1===b.state.wrap?b.adler=qa(b.adler,d,g,e):2===
b.state.wrap&&(b.adler=O(b.adler,d,g,e)),b.next_in+=g,b.total_in+=g,d=g);a.lookahead+=d;if(3<=a.lookahead+a.insert)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&!(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+3-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,3>a.lookahead+a.insert););}while(262>a.lookahead&&0!==a.strm.avail_in)}function Ka(a,c){for(var b;;){if(262>a.lookahead){T(a);if(262>a.lookahead&&
0===c)return 1;if(0===a.lookahead)break}b=0;3<=a.lookahead&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,b=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);0!==b&&a.strstart-b<=a.w_size-262&&(a.match_length=cb(a,b));if(3<=a.match_length)if(b=U._tr_tally(a,a.strstart-a.match_start,a.match_length-3),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&3<=a.lookahead){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+
3-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else b=U._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(b&&(E(a,!1),0===a.strm.avail_out))return 1}a.insert=2>a.strstart?a.strstart:2;return 4===c?(E(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(E(a,!1),0===
a.strm.avail_out)?1:2}function ka(a,c){for(var b,d;;){if(262>a.lookahead){T(a);if(262>a.lookahead&&0===c)return 1;if(0===a.lookahead)break}b=0;3<=a.lookahead&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,b=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);a.prev_length=a.match_length;a.prev_match=a.match_start;a.match_length=2;0!==b&&a.prev_length<a.max_lazy_match&&a.strstart-b<=a.w_size-262&&(a.match_length=cb(a,b),5>=a.match_length&&(1===a.strategy||
3===a.match_length&&4096<a.strstart-a.match_start)&&(a.match_length=2));if(3<=a.prev_length&&a.match_length<=a.prev_length){d=a.strstart+a.lookahead-3;b=U._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-3);a.lookahead-=a.prev_length-1;a.prev_length-=2;do++a.strstart<=d&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);a.match_available=0;a.match_length=2;a.strstart++;if(b&&(E(a,
!1),0===a.strm.avail_out))return 1}else if(a.match_available){if((b=U._tr_tally(a,0,a.window[a.strstart-1]))&&E(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return 1}else a.match_available=1,a.strstart++,a.lookahead--}a.match_available&&(U._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0);a.insert=2>a.strstart?a.strstart:2;return 4===c?(E(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(E(a,!1),0===a.strm.avail_out)?1:2}function Ab(a,c){for(var b,d,e,f=a.window;;){if(258>=a.lookahead){T(a);
if(258>=a.lookahead&&0===c)return 1;if(0===a.lookahead)break}a.match_length=0;if(3<=a.lookahead&&0<a.strstart&&(d=a.strstart-1,b=f[d],b===f[++d]&&b===f[++d]&&b===f[++d])){for(e=a.strstart+258;b===f[++d]&&b===f[++d]&&b===f[++d]&&b===f[++d]&&b===f[++d]&&b===f[++d]&&b===f[++d]&&b===f[++d]&&d<e;);a.match_length=258-(e-d);a.match_length>a.lookahead&&(a.match_length=a.lookahead)}3<=a.match_length?(b=U._tr_tally(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=
0):(b=U._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++);if(b&&(E(a,!1),0===a.strm.avail_out))return 1}a.insert=0;return 4===c?(E(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(E(a,!1),0===a.strm.avail_out)?1:2}function Bb(a,c){for(var b;;){if(0===a.lookahead&&(T(a),0===a.lookahead)){if(0===c)return 1;break}a.match_length=0;b=U._tr_tally(a,0,a.window[a.strstart]);a.lookahead--;a.strstart++;if(b&&(E(a,!1),0===a.strm.avail_out))return 1}a.insert=0;return 4===c?(E(a,!0),0===a.strm.avail_out?
3:4):a.last_lit&&(E(a,!1),0===a.strm.avail_out)?1:2}function aa(a,c,b,d,e){this.good_length=a;this.max_lazy=c;this.nice_length=b;this.max_chain=d;this.func=e}function Cb(){this.strm=null;this.status=0;this.pending_buf=null;this.wrap=this.pending=this.pending_out=this.pending_buf_size=0;this.gzhead=null;this.gzindex=0;this.method=8;this.last_flush=-1;this.w_mask=this.w_bits=this.w_size=0;this.window=null;this.window_size=0;this.head=this.prev=null;this.nice_match=this.good_match=this.strategy=this.level=
this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0;this.dyn_ltree=new A.Buf16(1146);this.dyn_dtree=new A.Buf16(122);this.bl_tree=new A.Buf16(78);da(this.dyn_ltree);da(this.dyn_dtree);da(this.bl_tree);this.bl_desc=this.d_desc=this.l_desc=null;this.bl_count=new A.Buf16(16);this.heap=new A.Buf16(573);da(this.heap);
this.heap_max=this.heap_len=0;this.depth=new A.Buf16(573);da(this.depth);this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function db(a){var c;if(!a||!a.state)return ca(a,-2);a.total_in=a.total_out=0;a.data_type=2;c=a.state;c.pending=0;c.pending_out=0;0>c.wrap&&(c.wrap=-c.wrap);c.status=c.wrap?42:113;a.adler=2===c.wrap?0:1;c.last_flush=0;U._tr_init(c);return 0}function eb(a){var c=db(a);0===c&&(a=a.state,a.window_size=
2*a.w_size,da(a.head),a.max_lazy_match=na[a.level].max_lazy,a.good_match=na[a.level].good_length,a.nice_match=na[a.level].nice_length,a.max_chain_length=na[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0);return c}function fb(a,c,b,d,e,f){if(!a)return-2;var g=1;-1===c&&(c=6);0>d?(g=0,d=-d):15<d&&(g=2,d-=16);if(1>e||9<e||8!==b||8>d||15<d||0>c||9<c||0>f||4<f)return ca(a,-2);8===d&&(d=9);var k=new Cb;a.state=k;k.strm=
a;k.wrap=g;k.gzhead=null;k.w_bits=d;k.w_size=1<<k.w_bits;k.w_mask=k.w_size-1;k.hash_bits=e+7;k.hash_size=1<<k.hash_bits;k.hash_mask=k.hash_size-1;k.hash_shift=~~((k.hash_bits+3-1)/3);k.window=new A.Buf8(2*k.w_size);k.head=new A.Buf16(k.hash_size);k.prev=new A.Buf16(k.w_size);k.lit_bufsize=1<<e+6;k.pending_buf_size=4*k.lit_bufsize;k.pending_buf=new A.Buf8(k.pending_buf_size);k.d_buf=1*k.lit_bufsize;k.l_buf=3*k.lit_bufsize;k.level=c;k.strategy=f;k.method=b;return eb(a)}function gb(a,c){if(65537>c&&
(a.subarray&&hb||!a.subarray&&ib))return String.fromCharCode.apply(null,A.shrinkBuf(a,c));for(var b="",d=0;d<c;d++)b+=String.fromCharCode(a[d]);return b}function ha(a){if(!(this instanceof ha))return new ha(a);a=this.options=A.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},a||{});a.raw&&0<a.windowBits?a.windowBits=-a.windowBits:a.gzip&&0<a.windowBits&&16>a.windowBits&&(a.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new jb;this.strm.avail_out=
0;var c=ra.deflateInit2(this.strm,a.level,a.method,a.windowBits,a.memLevel,a.strategy);if(0!==c)throw Error(ja[c]);a.header&&ra.deflateSetHeader(this.strm,a.header);if(a.dictionary){a="string"===typeof a.dictionary?V.string2buf(a.dictionary):"[object ArrayBuffer]"===kb.call(a.dictionary)?new Uint8Array(a.dictionary):a.dictionary;c=ra.deflateSetDictionary(this.strm,a);if(0!==c)throw Error(ja[c]);this._dict_set=!0}}function La(a,c){var b=new ha(c);b.push(a,!0);if(b.err)throw b.msg||ja[b.err];return b.result}
function lb(a){return(a>>>24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24)}function Db(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=this.length=this.bits=this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new A.Buf16(320);this.work=new A.Buf16(288);this.distdyn=
this.lendyn=null;this.was=this.back=this.sane=0}function mb(a){var c;if(!a||!a.state)return-2;c=a.state;a.total_in=a.total_out=c.total=0;a.msg="";c.wrap&&(a.adler=c.wrap&1);c.mode=1;c.last=0;c.havedict=0;c.dmax=32768;c.head=null;c.hold=0;c.bits=0;c.lencode=c.lendyn=new A.Buf32(852);c.distcode=c.distdyn=new A.Buf32(592);c.sane=1;c.back=-1;return 0}function nb(a){var c;if(!a||!a.state)return-2;c=a.state;c.wsize=0;c.whave=0;c.wnext=0;return mb(a)}function ob(a,c){var b,d;if(!a||!a.state)return-2;d=a.state;
0>c?(b=0,c=-c):(b=(c>>4)+1,48>c&&(c&=15));if(c&&(8>c||15<c))return-2;null!==d.window&&d.wbits!==c&&(d.window=null);d.wrap=b;d.wbits=c;return nb(a)}function pb(a,c){var b;if(!a)return-2;b=new Db;a.state=b;b.window=null;b=ob(a,c);0!==b&&(a.state=null);return b}function qb(a,c,b,d){var e=a.state;null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new A.Buf8(e.wsize));d>=e.wsize?(A.arraySet(e.window,c,b-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(a=e.wsize-e.wnext,a>d&&(a=d),A.arraySet(e.window,
c,b-d,a,e.wnext),(d-=a)?(A.arraySet(e.window,c,b-d,d,0),e.wnext=d,e.whave=e.wsize):(e.wnext+=a,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=a)));return 0}function la(a){if(!(this instanceof la))return new la(a);var c=this.options=A.assign({chunkSize:16384,windowBits:0,to:""},a||{});c.raw&&0<=c.windowBits&&16>c.windowBits&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15));!(0<=c.windowBits&&16>c.windowBits)||a&&a.windowBits||(c.windowBits+=32);15<c.windowBits&&48>c.windowBits&&
0===(c.windowBits&15)&&(c.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new jb;this.strm.avail_out=0;a=sa.inflateInit2(this.strm,c.windowBits);if(a!==I.Z_OK)throw Error(ja[a]);this.header=new Eb;sa.inflateGetHeader(this.strm,this.header)}function Ma(a,c){var b=new la(c);b.push(a,!0);if(b.err)throw b.msg||ja[b.err];return b.result}var P=function(){this._uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:c&
3|8).toString(16)});this._metadata={};this._type=P.TYPE()};P.TYPE=function(){return"GENERIC"};P.prototype.isOfType=function(a){return!this._type.localeCompare(a)};P.prototype.getType=function(){this._type};P.prototype.getUuid=function(){return this._uuid.slice()};P.prototype.setMetadata=function(a,c){"string"===typeof a||a instanceof String?this._metadata[a]=c:console.warn("The given key must be a String Object.")};P.prototype.getMetadata=function(a){if(a in this._metadata)return this._metadata[a];
console.warn("The metadata with key: "+a+" doe not exist.");return null};P.prototype.hasMetadata=function(a){return a in this._metadata};P.prototype.getMetadataKeys=function(){return Object.keys(this._metadata)};P.prototype.copyMetadataFrom=function(a){var c=this;a.getMetadataKeys().forEach(function(b){try{var d=JSON.parse(JSON.stringify(a.getMetadata(b)));c.setMetadata(b,d)}catch(e){console.error(e)}})};P.prototype.getMetadataCopy=function(){return JSON.parse(JSON.stringify(this._metadata))};var v=
function(){var a;a=P.call(this)||this;a._type=v.TYPE();a._events={};a._inputValidator={};a._input={};a._output={};a._timer={};a._isOutputReady=!1;return a};$jscomp.inherits(v,P);v.TYPE=function(){return"FILTER"};v.prototype.addInput=function(a,c){c=void 0===c?0:c;c in this._input||(this._input[c]=null);this._input[c]=a;this._isOutputReady=!1};v.prototype.getOutput=function(a){a=void 0===a?0:a;return a in this._output?this._output[a]:null};v.prototype.forEachOutput=function(a){if(a)for(var c=this.getOutputCategories(),
b=0;b<c.length;b++)a(c[b],this.getOutput(c[b]));else console.warn("forEachOutput requires a callback.")};v.prototype._forEachInput=function(a){if(a)for(var c=this.getInputCategories(),b=0;b<c.length;b++)a(c[b],this._getInput(c[b]));else console.warn("forEachOutput requires a callback.")};v.prototype._addOutput=function(a,c){c=void 0===c?0:c;var b=null;c in this._output?console.warn("An output of category "+c+" was already defined. Nothing to be done."):(b=new a,this._output[c]=b,console.log("filter "+
this.constructor.name+" creates a new output."));return b};v.prototype._getInput=function(a){a=void 0===a?0:a;return a in this._input?this._input[a]:null};v.prototype.hasInputOfCategory=function(a){return a in this._input};v.prototype.getInputCategories=function(){return Object.keys(this._input)};v.prototype.getOutputCategories=function(){return Object.keys(this._output)};v.prototype.setMetadata=function(a,c){P.prototype.setMetadata.call(this,a,c);this._isOutputReady=!1};v.prototype.hasOutputReady=
function(){return this._isOutputReady};v.prototype.setOutputAsReady=function(){this._isOutputReady=!0};v.prototype.hasValidInput=function(){var a=this,c=!0;Object.keys(this._inputValidator).forEach(function(b){c=c&&a._getInput(b).isOfType(a._inputValidator[b])});c||console.warn("The input is not valid.");return c};v.prototype.update=function(){this.addTimeRecord("begin");this._run();this.addTimeRecord("end");console.log("Running time for filter "+this.constructor.name+": "+this.getTime("begin","end")+
"ms.");this.setOutputAsReady()};v.prototype._run=function(){console.error("The update() method has not been written, this filter is not valid.")};v.prototype.addTimeRecord=function(a){this._timer[a]=performance.now()};v.prototype.getTime=function(a,c,b){b=void 0===b?!1:b;if(a in this._timer&&c in this._timer){var d=Math.abs(this._timer[c]-this._timer[a]);b&&console.log("> Time: ["+a+" , "+c+"] is "+d+" millisec.");return d}console.warn("The two given record name must exist in the time record table.");
return-1};v.prototype.on=function(a,c){this._events[a]=c};v.prototype.getNumberOfInputs=function(){return Object.keys(this._input).length};v.prototype.getNumberOfOutputs=function(){return Object.keys(this._output).length};var ea=function(){var a;a=P.call(this)||this;a._data=null;return a};$jscomp.inherits(ea,P);ea.prototype.setRawData=function(a){this._data=a};ea.prototype.setRawMetadata=function(a){this._metadata=a};var x=function(a){var c;a=void 0===a?null:a;c=ea.call(this)||this;c._type=x.TYPE();
c.setMetadata("ncpp",4);if(a&&"width"in a&&"height"in a&&0<a.width&&0<a.height){c.setMetadata("width",a.width);c.setMetadata("height",a.height);"color"in a&&c.setMetadata("ncpp",a.color.length);c._data=new Float32Array(a.width*a.height*c.getMetadata("ncpp"));var b=c.getMetadata("ncpp");if("color"in a){a=a.color;for(var d=0;d<c._data.length;d++)c._data[d]=a[d%b];c.computeSimpleStat()}else c._data.fill(0)}return c};$jscomp.inherits(x,ea);x.TYPE=function(){return"IMAGE2D"};x.prototype.clone=function(){var a=
new x;a.setData(this._data,this.getMetadata("width"),this.getMetadata("height"),this.getMetadata("ncpp"),!0);a.copyMetadataFrom(this);return a};x.prototype.setData=function(a,c,b,d,e){d=void 0===d?4:d;e=void 0===e?!1:e;this.setMetadata("ncpp",d);a.length!=c*b*d?console.warn("The array size does not match the width and height. Cannot init the Image2D."):(this._data=e?new a.constructor(a):a,this.setMetadata("width",c),this.setMetadata("height",b),this.computeSimpleStat())};x.prototype.setPixel=function(a,
c,b){b=void 0===b?!1:b;if(this._data){var d=this._metadata.ncpp;if("x"in a&&0<=a.x&&a.x<this._metadata.width&&"y"in a&&0<=a.y&&a.y<this._metadata.height&&c.length==d){a=this.get1dIndexFrom2dPosition(a);if(1==d)this._data[a]=c[0];else{a*=d;for(var e=0;e<d;e++)this._data[a+e]=c[e]}b&&this.computeSimpleStat()}else console.error("x and y position have to be within the image dimensions and color size must be the same as the original image.")}else console.warn("The image is empty")};x.prototype.getPixel=
function(a){if(this._data){if("x"in a&&0<=a.x&&a.x<this._metadata.width&&"y"in a&&0<=a.y&&a.y<this._metadata.height){var c=this._metadata.ncpp;a=this.get1dIndexFrom2dPosition(a);1==c?c=[this._data[a]]:(a*=c,c=this._data.slice(a,a+c));return c}console.warn("The requested position is outside the image.");return null}console.warn("The image is empty")};x.prototype.getWidth=function(){return this._metadata.width};x.prototype.getHeight=function(){return this._metadata.height};x.prototype.getComponentsPerPixel=
function(){return this._metadata.ncpp};x.prototype.getData=function(){return this._data};x.prototype.getDataCopy=function(){return new this._data.constructor(this._data)};x.prototype.getDataAsUInt8Array=function(){if(this._data){for(var a=this.getMin(),c=this.getMax(),b=new Uint8Array(this._data.length),d=0;d<this._data.length;d++)b[d]=(this._data[d]-a)/c*256;return b}console.warn("No data, cannot make a copy of it.")};x.prototype.get2dPositionFrom1dIndex=function(a){return{x:a%this._metadata.width,
y:Math.floor(a/this._metadata.width)}};x.prototype.get1dIndexFrom2dPosition=function(a){return a.x+a.y*this._metadata.width};x.prototype.computeSimpleStat=function(){if(this._data){for(var a=Infinity,c=-Infinity,b=0,d=0;d<this._data.length;d++)a=Math.min(a,this._data[d]),c=Math.max(a,this._data[d]),b+=this._data[d];this.setMetadata("min",a);this.setMetadata("max",c);this.setMetadata("avg",b/this._data.length)}else console.warn("The image is empty")};x.prototype.getMin=function(){this.hasMetadata("min")||
this.computeSimpleStat();return this.getMetadata("min")};x.prototype.getMax=function(){this.hasMetadata("max")||this.computeSimpleStat();return this.getMetadata("max")};x.prototype.getAvg=function(){this.hasMetadata("avg")||this.computeSimpleStat();return this.getMetadata("avg")};var H=function(a){var c;a=void 0===a?null:a;c=ea.call(this)||this;c._type=H.TYPE();c.setMetadata("ncpp",1);a&&"order"in a?c.setMetadata("order",a.order):c.setMetadata("order",["zspace","yspace","xspace"]);var b={offset:1,
step:1},d={step:1},e={step:1};c.setMetadata("xspace",b);c.setMetadata("yspace",d);c.setMetadata("zspace",e);a&&"ncpp"in a&&c.setMetadata("ncpp",a.ncpp);a&&"xSize"in a&&"ySize"in a&&"zSize"in a&&0<a.xSize&&0<a.ySize&&0<a.zSize&&(b.space_length=a.xSize,d.space_length=a.ySize,e.space_length=a.zSize,d.offset=b.space_length,e.offset=b.space_length*d.space_length,c._data=new Float32Array(a.xSize*a.ySize*a.zSize*c.getMetadata("ncpp")),c._data.fill(0),c._scanDataRange(),c._finishHeader());return c};$jscomp.inherits(H,
ea);H.TYPE=function(){return"IMAGE3D"};H.prototype.clone=function(){var a=new H;a.setData(this._data,this.getMetadata("xspace").space_length,this.getMetadata("yspace").space_length,this.getMetadata("zspace").space_length,{ncpp:this.getMetadata("ncpp"),order:this.getMetadata("order").slice(),deepCopy:!0});a.copyMetadataFrom(this);return a};H.prototype.setData=function(a,c,b,d,e){var f=1;e&&"ncpp"in e&&(f=e.ncpp);a.length!=c*b*d*f?console.warn("The array size does not match the width and height. Cannot init the Image3D."):
(e&&"ncpp"in e&&this.setMetadata("ncpp",e.ncpp),e&&"order"in e&&this.setMetadata("order",e.order),this._data=e&&"deepCopy"in e&&e.deepCopy?new a.constructor(a):a,a=this.getMetadata("xspace"),e=this.getMetadata("yspace"),f=this.getMetadata("zspace"),a.space_length=c,e.space_length=b,f.space_length=d,e.offset=a.space_length,f.offset=a.space_length*e.space_length,this._scanDataRange(),this._finishHeader())};H.prototype._finishHeader=function(){var a=this.getMetadata("xspace"),c=this.getMetadata("yspace"),
b=this.getMetadata("zspace");a.name="xspace";c.name="yspace";b.name="zspace";a.width_space=JSON.parse(JSON.stringify(c));a.width=c.space_length;a.height_space=JSON.parse(JSON.stringify(b));a.height=b.space_length;c.width_space=JSON.parse(JSON.stringify(a));c.width=a.space_length;c.height_space=JSON.parse(JSON.stringify(b));c.height=b.space_length;b.width_space=JSON.parse(JSON.stringify(a));b.width=a.space_length;b.height_space=JSON.parse(JSON.stringify(c));b.height=c.space_length};H.prototype._scanDataRange=
function(){for(var a=Infinity,c=-Infinity,b=0;b<this._data.length;b++)a=Math.min(a,this._data[b]),c=Math.max(c,this._data[b]);this.setMetadata("voxel_min",a);this.setMetadata("voxel_max",c)};H.prototype.setPixel=function(a,c){};H.prototype.getPixel=function(a){};H.prototype.getSize=function(a){if(this.hasMetadata(a))return this.getMetadata(a).space_length;console.warn('The space must be "xspace", "yspace" or "zspace".');return null};H.prototype.getData=function(){return this._data};H.prototype.getDataCopy=
function(){return new this._data.constructor(this._data)};H.prototype.get1dIndexFrom3dPosition=function(a){};H.prototype.getSlice=function(a,c,b){c=void 0===c?0:c;b=void 0===b?0:b;if(!this.hasMetadata(a))return console.warn("The axis "+a+" does not exist."),null;var d=this.hasMetadata("time")?b*this.getMetadata("time").offset:0,e=this.getMetadata(a),f=e.width_space,g=e.height_space;a=e.width;b=e.height;var k=e.offset,r=f.offset,l=g.offset,m=new this._data.constructor(a*b),h,f=0<f.step,B=0<g.step;
h=0<e.step;var n=g=0,q=Infinity,y=-Infinity;this.getMetadata("voxel_max");c=h?c:e.space_length-c-1;if(0<=c&&c<e.space_length)for(d+=c*k,c=b-1;0<=c;c--)for(e=B?c:b-c-1,k=d+e*l,e=0;e<a;e++)h=f?e:a-e-1,h=k+h*r,h=this._data[h],q=Math.min(q,h),y=Math.max(y,h),n+=h,m[g++]=h;r=new x;r.setData(m,a,b,1);r.setMetadata("min",q);r.setMetadata("max",y);r.setMetadata("avg",n/(g-1));return r};H.prototype.getIntensity_ijk=function(a,c,b,d){d=void 0===d?0:d;var e=this.getMetadata("order");if(0>a||a>=this.getMetadata(e[0]).space_length||
0>c||c>=this.getMetadata(e[1]).space_length||0>b||b>=this.getMetadata(e[2]).space_length)return console.warn("getIntensity_ijk position is out of range."),0;d=this.hasMetadata("time")?d*this.getMetadata("time").offset:0;a=a*this.getMetadata(e[0]).offset+c*this.getMetadata(e[1]).offset+b*this.getMetadata(e[2]).offset+d;return this._data[a]};H.prototype.getIntensity_xyz=function(a,c,b,d){d=void 0===d?0:d;this.getMetadata("order");if(0>a||a>=this.getMetadata("xspace").space_length||0>c||c>=this.getMetadata("yspace").space_length||
0>b||b>=this.getMetadata("zspace").space_length)return console.warn("getIntensity_xyz position is out of range."),0;d=this.hasMetadata("time")?d*this.getMetadata("time").offset:0;a=a*this.getMetadata("xspace").offset+c*this.getMetadata("yspace").offset+b*this.getMetadata("zspace").offset+d;return this._data[a]};var W=function(){var a;a=v.call(this)||this;a._inputValidator[0]=x.TYPE();return a};$jscomp.inherits(W,v);W.prototype.hasSameSizeInput=function(){var a=this,c=!0,b=[],d=[];Object.keys(this._input).forEach(function(c){b.push(a._getInput(c).getWidth());
d.push(a._getInput(c).getHeight())});b.length&&(b.sort(),d.sort(),(c=b[0]==b[b.length-1]&&d[0]==d[d.length-1])||console.warn("Input image do not all have the same size. Filter not valid"));return c};W.prototype.hasSameNcppInput=function(){var a=Object.keys(this._input);if(!a.length)return!1;for(var c=this._getInput(a[0]).getComponentsPerPixel(),b=0;b<a.length;b++)if(c!=this._getInput(a[b]).getComponentsPerPixel())return console.warn("Input image do not all have the same number of components per pixel. Filter not valid"),
!1;return!0};var X=function(a){return H.call(this)||this};$jscomp.inherits(X,H);X.transformToMinc=function(a,c){function b(a){a=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0>=a&&(a=1);return Math.sqrt(a)}function d(a,b,c){return a[0]*(b[1]*c[2]-b[2]*c[1])-a[1]*(b[0]*c[2]-b[2]*c[0])+a[2]*(b[0]*c[1]-b[1]*c[0])}for(var e=[],f=[],g=[],k=b(a[0]),r=b(a[1]),l=b(a[2]),k=0>a[0][0]?-k:k,r=0>a[1][1]?-r:r,l=0>a[2][2]?-l:l,m=0;3>m;m++)e[m]=a[m][0]/k,f[m]=a[m][1]/r,g[m]=a[m][2]/l;c.xspace.step=k;c.yspace.step=r;c.zspace.step=
l;m=[a[0][3],a[1][3],a[2][3]];k=d(e,f,g);l=d(m,f,g);r=d(e,m,g);m=d(e,f,m);c.xspace.start=l/k;c.yspace.start=r/k;c.zspace.start=m/k;c.xspace.direction_cosines=e;c.yspace.direction_cosines=f;c.zspace.direction_cosines=g};X.swapn=function(a,c){for(var b=0;b<a.length;b+=c)for(var d=c-1,e=0;d>e;){var f=a[b+d];a[b+d]=a[b+e];a[b+e]=f;d--;e++}};X.prototype.setData=function(a,c){var b=this;this._data=a;this.setMetadata("position",{});this.setMetadata("current_time",0);Object.keys(c).forEach(function(a){b.setMetadata(a,
c[a])});this._scanDataRange();this._saveOriginAndTransform();this._finishHeader();console.log(this._metadata)};X.prototype._saveOriginAndTransform=function(){var a=this.getMetadata("xspace"),c=this.getMetadata("yspace"),b=this.getMetadata("zspace"),d=a.start,e=c.start,f=b.start,g=a.direction_cosines,k=c.direction_cosines,r=b.direction_cosines,a=a.step,c=c.step,b=b.step,d={x:d*g[0]+e*k[0]+f*r[0],y:d*g[1]+e*k[1]+f*r[1],z:d*g[2]+e*k[2]+f*r[2]};this.setMetadata("voxel_origin",d);this.setMetadata("w2v",
[[g[0]/a,g[1]/a,g[2]/a,(-d.x*g[0]-d.y*g[1]-d.z*g[2])/a],[k[0]/c,k[1]/c,k[2]/c,(-d.x*k[0]-d.y*k[1]-d.z*k[2])/c],[r[0]/b,r[1]/b,r[2]/b,(-d.x*r[0]-d.y*r[1]-d.z*r[2])/b]])};var ta=function(){var a;a=v.call(this)||this;a._inputValidator[0]=x.TYPE();a.setMetadata("alpha",!1);a.setMetadata("min",0);a.setMetadata("max",255);a.setMetadata("reset",!0);a._canvas=null;a._ctx=null;return a};$jscomp.inherits(ta,v);ta.prototype._init=function(){var a=document.getElementById(this.getMetadata("parentDivID"));if(!a)return!1;
if(this.getMetadata("reset"))for(;a.firstChild;)a.removeChild(a.firstChild);this._canvas=document.createElement("canvas");this._canvas.style="image-rendering: pixelated;";this._ctx=this._canvas.getContext("2d");this._ctx.imageSmoothingEnabled=!0;this._ctx.mozImageSmoothingEnabled=!1;this._ctx.webkitImageSmoothingEnabled=!1;this._ctx.ctxmsImageSmoothingEnabled=!1;document.getElementById(this.getMetadata("parentDivID")).appendChild(this._canvas);return!0};ta.prototype._run=function(){if(this.hasValidInput()){var a=
this._input[0],c=a.getComponentsPerPixel();if(1!=c&&4!=c)console.warn("Cannot write Image in canvas if contains other than 1 or 4 bands.");else if(this.getMetadata("parentDivID"))if(this._init()){var b=this.getMetadata("alpha");this._canvas.width=a.getWidth();this._canvas.height=a.getHeight();var d=this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height),e=d.data,a=a.getData();if(4==c)for(c=0;c<a.length;c++)e[c]=b||3!=c%4?this._stretchMinMax(a[c]):255;else if(1==c)for(c=0;c<a.length;c++){var b=
4*c,f=this._stretchMinMax(a[c]);e[b]=f;e[b+1]=f;e[b+2]=f;e[b+3]=255}else if(3==c)for(console.warn("From RGB Image2D to RGBA canvas, not sure of this implementation."),c=b=0;c<a.length;c++)3==c%4&&(e[b]=255,b++),e[b]=this._stretchMinMax(value),b++;this._ctx.putImageData(d,0,0)}else console.warn("The parent div was not specified or does not exist.");else console.error("The parent DIV ID to place the canvas element was not specified. Unable to display anything.")}};ta.prototype._stretchMinMax=function(a){var c=
this._metadata.min,b=this._metadata.max;return 0==c&&255==b?a:(a-c)/(b-c)*255};var Ca=function(a){a=v.call(this)||this;a._loadedCounter=0;a._addOutput(x,0);return a};$jscomp.inherits(Ca,v);Ca.prototype._run=function(){var a=this;this.getInputCategories().forEach(function(c){a._addOutput(x,c);a._loadImage(c)})};Ca.prototype._loadImage=function(a){var c=this,b=new Image;b.src=this._getInput(a);b.onload=function(){var d=document.createElement("canvas");d.width=b.width;d.height=b.height;var e=d.getContext("2d");
e.drawImage(b,0,0);try{var f=e.getImageData(0,0,d.width,d.height),g=new Float32Array(f.data);c.getOutput(a).setData(g,b.width,b.height);c._loadedCounter++;c._loadedCounter==c.getNumberOfInputs()&&"ready"in c._events&&c._events.ready(c)}catch(k){console.error(k)}}};var Da=function(){var a;a=v.call(this)||this;a._allowedTypes=/image.*/;a._addOutput(x,0);return a};$jscomp.inherits(Da,v);Da.prototype.hasValidInput=function(){var a=this._getInput();a&&a.type.match(this._allowedTypes)?this._isInputValid=
!0:console.error("The file must be an image (jpg/png). The type "+a.type+" is not compatible with FileImageReader.");return!1};Da.prototype._run=function(){if(this.hasValidInput){var a=this,c=this._getInput(),b=new FileReader;b.onload=function(c){c=new Image;c.src=b.result;var d=document.createElement("canvas");d.width=c.width;d.height=c.height;var f=d.getContext("2d");f.drawImage(c,0,0);d=f.getImageData(0,0,d.width,d.height).data;a.getOutput().setData(d,c.width,c.height);"ready"in a._events&&a._events.ready(a)};
b.readAsDataURL(c)}};var rb="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},A=t(function(a,c){var b="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!==typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a};c.shrinkBuf=function(a,
b){if(a.length===b)return a;if(a.subarray)return a.subarray(0,b);a.length=b;return a};var d={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)a.set(b.subarray(c,c+d),e);else for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f;b=d=0;for(c=a.length;b<c;b++)d+=a[b].length;f=new Uint8Array(d);b=d=0;for(c=a.length;b<c;b++)e=a[b],f.set(e,d),d+=e.length;return f}},e={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],
a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,d)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,e))};c.setTyped(b)}),Ha=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Aa=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Fb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],sb=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fa=Array(576);u(fa);var ua=Array(60);u(ua);var Y=Array(512);u(Y);var oa=Array(256);u(oa);var Ia=
Array(29);u(Ia);var Ba=Array(30);u(Ba);var tb,ub,vb,wb=!1,U={_tr_init:function(a){if(!wb){var c,b,d,e=Array(16);for(d=b=0;28>d;d++)for(Ia[d]=b,c=0;c<1<<Ha[d];c++)oa[b++]=d;oa[b-1]=d;for(d=b=0;16>d;d++)for(Ba[d]=b,c=0;c<1<<Aa[d];c++)Y[b++]=d;for(b>>=7;30>d;d++)for(Ba[d]=b<<7,c=0;c<1<<Aa[d]-7;c++)Y[256+b++]=d;for(c=0;15>=c;c++)e[c]=0;for(c=0;143>=c;)fa[2*c+1]=8,c++,e[8]++;for(;255>=c;)fa[2*c+1]=9,c++,e[9]++;for(;279>=c;)fa[2*c+1]=7,c++,e[7]++;for(;287>=c;)fa[2*c+1]=8,c++,e[8]++;Va(fa,287,e);for(c=0;30>
c;c++)ua[2*c+1]=5,ua[2*c]=Ua(c,5);tb=new w(fa,Ha,257,286,15);ub=new w(ua,Aa,0,30,15);vb=new w([],Fb,0,19,7);wb=!0}a.l_desc=new z(a.dyn_ltree,tb);a.d_desc=new z(a.dyn_dtree,ub);a.bl_desc=new z(a.bl_tree,vb);a.bi_buf=0;a.bi_valid=0;Wa(a)},_tr_stored_block:bb,_tr_flush_block:function(a,c,b,d){var e,f,g=0;if(0<a.level){2===a.strm.data_type&&(a.strm.data_type=zb(a));Ja(a,a.l_desc);Ja(a,a.d_desc);$a(a,a.dyn_ltree,a.l_desc.max_code);$a(a,a.dyn_dtree,a.d_desc.max_code);Ja(a,a.bl_desc);for(g=18;3<=g&&0===
a.bl_tree[2*sb[g]+1];g--);a.opt_len+=3*(g+1)+14;e=a.opt_len+3+7>>>3;f=a.static_len+3+7>>>3;f<=e&&(e=f)}else e=f=b+5;if(b+4<=e&&-1!==c)bb(a,c,b,d);else if(4===a.strategy||f===e)D(a,2+(d?1:0),3),Za(a,fa,ua);else{D(a,4+(d?1:0),3);c=a.l_desc.max_code+1;b=a.d_desc.max_code+1;g+=1;D(a,c-257,5);D(a,b-1,5);D(a,g-4,4);for(e=0;e<g;e++)D(a,a.bl_tree[2*sb[e]+1],3);ab(a,a.dyn_ltree,c-1);ab(a,a.dyn_dtree,b-1);Za(a,a.dyn_ltree,a.dyn_dtree)}Wa(a);d&&Xa(a)},_tr_tally:function(a,c,b){a.pending_buf[a.d_buf+2*a.last_lit]=
c>>>8&255;a.pending_buf[a.d_buf+2*a.last_lit+1]=c&255;a.pending_buf[a.l_buf+a.last_lit]=b&255;a.last_lit++;0===c?a.dyn_ltree[2*b]++:(a.matches++,c--,a.dyn_ltree[2*(oa[b]+256+1)]++,a.dyn_dtree[2*(256>c?Y[c]:Y[256+(c>>>7)])]++);return a.last_lit===a.lit_bufsize-1},_tr_align:function(a){D(a,2,3);G(a,256,fa);16===a.bi_valid?(J(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):8<=a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf&255,a.bi_buf>>=8,a.bi_valid-=8)}},qa=function(a,c,b,d){var e=a&65535|0;a=a>>>16&65535|0;
for(var f;0!==b;){f=2E3<b?2E3:b;b-=f;do e=e+c[d++]|0,a=a+e|0;while(--f);e%=65521;a%=65521}return e|a<<16|0},Gb=function(){for(var a,c=[],b=0;256>b;b++){a=b;for(var d=0;8>d;d++)a=a&1?3988292384^a>>>1:a>>>1;c[b]=a}return c}(),O=function(a,c,b,d){b=d+b;for(a^=-1;d<b;d++)a=a>>>8^Gb[(a^c[d])&255];return a^-1},ja={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},na;na=[new aa(0,0,0,
0,function(a,c){var b=65535;for(b>a.pending_buf_size-5&&(b=a.pending_buf_size-5);;){if(1>=a.lookahead){T(a);if(0===a.lookahead&&0===c)return 1;if(0===a.lookahead)break}a.strstart+=a.lookahead;a.lookahead=0;var d=a.block_start+b;if(0===a.strstart||a.strstart>=d)if(a.lookahead=a.strstart-d,a.strstart=d,E(a,!1),0===a.strm.avail_out)return 1;if(a.strstart-a.block_start>=a.w_size-262&&(E(a,!1),0===a.strm.avail_out))return 1}a.insert=0;if(4===c)return E(a,!0),0===a.strm.avail_out?3:4;a.strstart>a.block_start&&
E(a,!1);return 1}),new aa(4,4,8,4,Ka),new aa(4,5,16,8,Ka),new aa(4,6,32,32,Ka),new aa(4,4,16,16,ka),new aa(8,16,32,32,ka),new aa(8,16,128,128,ka),new aa(8,32,128,256,ka),new aa(32,128,258,1024,ka),new aa(32,258,258,4096,ka)];var ra={deflateInit:function(a,c){return fb(a,c,8,15,8,0)},deflateInit2:fb,deflateReset:eb,deflateResetKeep:db,deflateSetHeader:function(a,c){if(!a||!a.state||2!==a.state.wrap)return-2;a.state.gzhead=c;return 0},deflate:function(a,c){var b,d,e,f;if(!a||!a.state||5<c||0>c)return a?
ca(a,-2):-2;d=a.state;if(!a.output||!a.input&&0!==a.avail_in||666===d.status&&4!==c)return ca(a,0===a.avail_out?-5:-2);d.strm=a;b=d.last_flush;d.last_flush=c;42===d.status&&(2===d.wrap?(a.adler=0,C(d,31),C(d,139),C(d,8),d.gzhead?(C(d,(d.gzhead.text?1:0)+(d.gzhead.hcrc?2:0)+(d.gzhead.extra?4:0)+(d.gzhead.name?8:0)+(d.gzhead.comment?16:0)),C(d,d.gzhead.time&255),C(d,d.gzhead.time>>8&255),C(d,d.gzhead.time>>16&255),C(d,d.gzhead.time>>24&255),C(d,9===d.level?2:2<=d.strategy||2>d.level?4:0),C(d,d.gzhead.os&
255),d.gzhead.extra&&d.gzhead.extra.length&&(C(d,d.gzhead.extra.length&255),C(d,d.gzhead.extra.length>>8&255)),d.gzhead.hcrc&&(a.adler=O(a.adler,d.pending_buf,d.pending,0)),d.gzindex=0,d.status=69):(C(d,0),C(d,0),C(d,0),C(d,0),C(d,0),C(d,9===d.level?2:2<=d.strategy||2>d.level?4:0),C(d,3),d.status=113)):(e=8+(d.w_bits-8<<4)<<8,e|=(2<=d.strategy||2>d.level?0:6>d.level?1:6===d.level?2:3)<<6,0!==d.strstart&&(e|=32),d.status=113,pa(d,e+(31-e%31)),0!==d.strstart&&(pa(d,a.adler>>>16),pa(d,a.adler&65535)),
a.adler=1));if(69===d.status)if(d.gzhead.extra){for(e=d.pending;d.gzindex<(d.gzhead.extra.length&65535)&&(d.pending!==d.pending_buf_size||(d.gzhead.hcrc&&d.pending>e&&(a.adler=O(a.adler,d.pending_buf,d.pending-e,e)),Z(a),e=d.pending,d.pending!==d.pending_buf_size));)C(d,d.gzhead.extra[d.gzindex]&255),d.gzindex++;d.gzhead.hcrc&&d.pending>e&&(a.adler=O(a.adler,d.pending_buf,d.pending-e,e));d.gzindex===d.gzhead.extra.length&&(d.gzindex=0,d.status=73)}else d.status=73;if(73===d.status)if(d.gzhead.name){e=
d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>e&&(a.adler=O(a.adler,d.pending_buf,d.pending-e,e)),Z(a),e=d.pending,d.pending===d.pending_buf_size)){f=1;break}f=d.gzindex<d.gzhead.name.length?d.gzhead.name.charCodeAt(d.gzindex++)&255:0;C(d,f)}while(0!==f);d.gzhead.hcrc&&d.pending>e&&(a.adler=O(a.adler,d.pending_buf,d.pending-e,e));0===f&&(d.gzindex=0,d.status=91)}else d.status=91;if(91===d.status)if(d.gzhead.comment){e=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&
d.pending>e&&(a.adler=O(a.adler,d.pending_buf,d.pending-e,e)),Z(a),e=d.pending,d.pending===d.pending_buf_size)){f=1;break}f=d.gzindex<d.gzhead.comment.length?d.gzhead.comment.charCodeAt(d.gzindex++)&255:0;C(d,f)}while(0!==f);d.gzhead.hcrc&&d.pending>e&&(a.adler=O(a.adler,d.pending_buf,d.pending-e,e));0===f&&(d.status=103)}else d.status=103;103===d.status&&(d.gzhead.hcrc?(d.pending+2>d.pending_buf_size&&Z(a),d.pending+2<=d.pending_buf_size&&(C(d,a.adler&255),C(d,a.adler>>8&255),a.adler=0,d.status=
113)):d.status=113);if(0!==d.pending){if(Z(a),0===a.avail_out)return d.last_flush=-1,0}else if(0===a.avail_in&&(c<<1)-(4<c?9:0)<=(b<<1)-(4<b?9:0)&&4!==c)return ca(a,-5);if(666===d.status&&0!==a.avail_in)return ca(a,-5);if(0!==a.avail_in||0!==d.lookahead||0!==c&&666!==d.status){b=2===d.strategy?Bb(d,c):3===d.strategy?Ab(d,c):na[d.level].func(d,c);if(3===b||4===b)d.status=666;if(1===b||3===b)return 0===a.avail_out&&(d.last_flush=-1),0;if(2===b&&(1===c?U._tr_align(d):5!==c&&(U._tr_stored_block(d,0,0,
!1),3===c&&(da(d.head),0===d.lookahead&&(d.strstart=0,d.block_start=0,d.insert=0))),Z(a),0===a.avail_out))return d.last_flush=-1,0}if(4!==c)return 0;if(0>=d.wrap)return 1;2===d.wrap?(C(d,a.adler&255),C(d,a.adler>>8&255),C(d,a.adler>>16&255),C(d,a.adler>>24&255),C(d,a.total_in&255),C(d,a.total_in>>8&255),C(d,a.total_in>>16&255),C(d,a.total_in>>24&255)):(pa(d,a.adler>>>16),pa(d,a.adler&65535));Z(a);0<d.wrap&&(d.wrap=-d.wrap);return 0!==d.pending?0:1},deflateEnd:function(a){var c;if(!a||!a.state)return-2;
c=a.state.status;if(42!==c&&69!==c&&73!==c&&91!==c&&103!==c&&113!==c&&666!==c)return ca(a,-2);a.state=null;return 113===c?ca(a,-3):0},deflateSetDictionary:function(a,c){var b=c.length,d,e,f,g,k,h;if(!a||!a.state)return-2;d=a.state;f=d.wrap;if(2===f||1===f&&42!==d.status||d.lookahead)return-2;1===f&&(a.adler=qa(a.adler,c,b,0));d.wrap=0;b>=d.w_size&&(0===f&&(da(d.head),d.strstart=0,d.block_start=0,d.insert=0),g=new A.Buf8(d.w_size),A.arraySet(g,c,b-d.w_size,d.w_size,0),c=g,b=d.w_size);g=a.avail_in;
k=a.next_in;h=a.input;a.avail_in=b;a.next_in=0;a.input=c;for(T(d);3<=d.lookahead;){b=d.strstart;e=d.lookahead-2;do d.ins_h=(d.ins_h<<d.hash_shift^d.window[b+3-1])&d.hash_mask,d.prev[b&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=b,b++;while(--e);d.strstart=b;d.lookahead=2;T(d)}d.strstart+=d.lookahead;d.block_start=d.strstart;d.insert=d.lookahead;d.lookahead=0;d.match_length=d.prev_length=2;d.match_available=0;a.next_in=k;a.input=h;a.avail_in=g;d.wrap=f;return 0},deflateInfo:"pako deflate (from Nodeca project)"},
ib=!0,hb=!0;try{String.fromCharCode.apply(null,[0])}catch(a){ib=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){hb=!1}for(var va=new A.Buf8(256),ga=0;256>ga;ga++)va[ga]=252<=ga?6:248<=ga?5:240<=ga?4:224<=ga?3:192<=ga?2:1;va[254]=va[254]=1;var V={string2buf:function(a){var c,b,d,e,f,g=a.length,k=0;for(e=0;e<g;e++)b=a.charCodeAt(e),55296===(b&64512)&&e+1<g&&(d=a.charCodeAt(e+1),56320===(d&64512)&&(b=65536+(b-55296<<10)+(d-56320),e++)),k+=128>b?1:2048>b?2:65536>b?3:4;c=new A.Buf8(k);
for(e=f=0;f<k;e++)b=a.charCodeAt(e),55296===(b&64512)&&e+1<g&&(d=a.charCodeAt(e+1),56320===(d&64512)&&(b=65536+(b-55296<<10)+(d-56320),e++)),128>b?c[f++]=b:(2048>b?c[f++]=192|b>>>6:(65536>b?c[f++]=224|b>>>12:(c[f++]=240|b>>>18,c[f++]=128|b>>>12&63),c[f++]=128|b>>>6&63),c[f++]=128|b&63);return c},buf2binstring:function(a){return gb(a,a.length)},binstring2buf:function(a){for(var c=new A.Buf8(a.length),b=0,d=c.length;b<d;b++)c[b]=a.charCodeAt(b);return c},buf2string:function(a,c){var b,d,e,f,g=c||a.length,
k=Array(2*g);for(b=d=0;b<g;)if(e=a[b++],128>e)k[d++]=e;else if(f=va[e],4<f)k[d++]=65533,b+=f-1;else{for(e&=2===f?31:3===f?15:7;1<f&&b<g;)e=e<<6|a[b++]&63,f--;1<f?k[d++]=65533:65536>e?k[d++]=e:(e-=65536,k[d++]=55296|e>>10&1023,k[d++]=56320|e&1023)}return gb(k,d)},utf8border:function(a,c){var b;c=c||a.length;c>a.length&&(c=a.length);for(b=c-1;0<=b&&128===(a[b]&192);)b--;return 0>b||0===b?c:b+va[a[b]]>c?b:c}},jb=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=
this.avail_out=this.next_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0},kb=Object.prototype.toString;ha.prototype.push=function(a,c){var b=this.strm,d=this.options.chunkSize,e,f;if(this.ended)return!1;f=c===~~c?c:!0===c?4:0;"string"===typeof a?b.input=V.string2buf(a):"[object ArrayBuffer]"===kb.call(a)?b.input=new Uint8Array(a):b.input=a;b.next_in=0;b.avail_in=b.input.length;do{0===b.avail_out&&(b.output=new A.Buf8(d),b.next_out=0,b.avail_out=d);e=ra.deflate(b,f);if(1!==e&&0!==e)return this.onEnd(e),
this.ended=!0,!1;if(0===b.avail_out||0===b.avail_in&&(4===f||2===f))if("string"===this.options.to)this.onData(V.buf2binstring(A.shrinkBuf(b.output,b.next_out)));else this.onData(A.shrinkBuf(b.output,b.next_out))}while((0<b.avail_in||0===b.avail_out)&&1!==e);if(4===f)return e=ra.deflateEnd(this.strm),this.onEnd(e),this.ended=!0,0===e;2===f&&(this.onEnd(0),b.avail_out=0);return!0};ha.prototype.onData=function(a){this.chunks.push(a)};ha.prototype.onEnd=function(a){0===a&&(this.result="string"===this.options.to?
this.chunks.join(""):A.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};var Hb={Deflate:ha,deflate:La,deflateRaw:function(a,c){c=c||{};c.raw=!0;return La(a,c)},gzip:function(a,c){c=c||{};c.gzip=!0;return La(a,c)}},Ib=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Jb=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Kb=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,
1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Lb=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],wa=function(a,c,b,d,e,f,g,k){var h=k.bits,l,m,ba,B,n,q,y,t,p,v,S,u,w,x=0,C,z=new A.Buf16(16);n=new A.Buf16(16);var D,H=0,I,F,G;for(l=0;15>=l;l++)z[l]=0;for(m=0;m<d;m++)z[c[b+m]]++;B=h;for(ba=15;1<=ba&&0===z[ba];ba--);B>ba&&(B=ba);if(0===ba)return e[f++]=20971520,e[f++]=20971520,k.bits=1,0;for(h=1;h<ba&&0===z[h];h++);B<h&&(B=h);for(l=q=1;15>=l;l++)if(q<<=
1,q-=z[l],0>q)return-1;if(0<q&&(0===a||1!==ba))return-1;n[1]=0;for(l=1;15>l;l++)n[l+1]=n[l]+z[l];for(m=0;m<d;m++)0!==c[b+m]&&(g[n[c[b+m]]++]=m);0===a?(w=D=g,C=19):1===a?(w=Ib,x-=257,D=Jb,H-=257,C=256):(w=Kb,D=Lb,C=-1);m=t=0;l=h;u=f;d=B;n=0;v=-1;y=1<<B;S=y-1;if(1===a&&852<y||2===a&&592<y)return 1;for(;;){I=l-n;g[m]<C?(F=0,G=g[m]):g[m]>C?(F=D[H+g[m]],G=w[x+g[m]]):(F=96,G=0);q=1<<l-n;h=p=1<<d;do p-=q,e[u+(t>>n)+p]=I<<24|F<<16|G|0;while(0!==p);for(q=1<<l-1;t&q;)q>>=1;0!==q?(t&=q-1,t+=q):t=0;m++;if(0===
--z[l]){if(l===ba)break;l=c[b+g[m]]}if(l>B&&(t&S)!==v){0===n&&(n=B);u+=h;d=l-n;for(q=1<<d;d+n<ba;){q-=z[d+n];if(0>=q)break;d++;q<<=1}y+=1<<d;if(1===a&&852<y||2===a&&592<y)return 1;v=t&S;e[v]=B<<24|d<<16|u-f|0}}0!==t&&(e[u+t]=l-n<<24|4194304);k.bits=B;return 0},xb=!0,Na,Oa,sa={inflateReset:nb,inflateReset2:ob,inflateResetKeep:mb,inflateInit:function(a){return pb(a,15)},inflateInit2:pb,inflate:function(a,c){var b,d,e,f,g,k,h,l,m,t,B,n,q,y,p,v,u,S,w=new A.Buf8(4),C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,
13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return-2;b=a.state;12===b.mode&&(b.mode=13);g=a.next_out;e=a.output;h=a.avail_out;f=a.next_in;d=a.input;k=a.avail_in;l=b.hold;m=b.bits;t=k;B=h;S=0;a:for(;;)switch(b.mode){case 1:if(0===b.wrap){b.mode=13;break}for(;16>m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}if(b.wrap&2&&35615===l){b.check=0;w[0]=l&255;w[1]=l>>>8&255;b.check=O(b.check,w,2,0);m=l=0;b.mode=2;break}b.flags=0;b.head&&(b.head.done=!1);if(!(b.wrap&1)||(((l&255)<<8)+(l>>
8))%31){a.msg="incorrect header check";b.mode=30;break}if(8!==(l&15)){a.msg="unknown compression method";b.mode=30;break}l>>>=4;m-=4;q=(l&15)+8;if(0===b.wbits)b.wbits=q;else if(q>b.wbits){a.msg="invalid window size";b.mode=30;break}b.dmax=1<<q;a.adler=b.check=1;b.mode=l&512?10:12;m=l=0;break;case 2:for(;16>m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}b.flags=l;if(8!==(b.flags&255)){a.msg="unknown compression method";b.mode=30;break}if(b.flags&57344){a.msg="unknown header flags set";b.mode=30;break}b.head&&
(b.head.text=l>>8&1);b.flags&512&&(w[0]=l&255,w[1]=l>>>8&255,b.check=O(b.check,w,2,0));m=l=0;b.mode=3;case 3:for(;32>m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}b.head&&(b.head.time=l);b.flags&512&&(w[0]=l&255,w[1]=l>>>8&255,w[2]=l>>>16&255,w[3]=l>>>24&255,b.check=O(b.check,w,4,0));m=l=0;b.mode=4;case 4:for(;16>m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}b.head&&(b.head.xflags=l&255,b.head.os=l>>8);b.flags&512&&(w[0]=l&255,w[1]=l>>>8&255,b.check=O(b.check,w,2,0));m=l=0;b.mode=5;case 5:if(b.flags&1024){for(;16>
m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}b.length=l;b.head&&(b.head.extra_len=l);b.flags&512&&(w[0]=l&255,w[1]=l>>>8&255,b.check=O(b.check,w,2,0));m=l=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(b.flags&1024&&(n=b.length,n>k&&(n=k),n&&(b.head&&(q=b.head.extra_len-b.length,b.head.extra||(b.head.extra=Array(b.head.extra_len)),A.arraySet(b.head.extra,d,f,n,q)),b.flags&512&&(b.check=O(b.check,d,n,f)),k-=n,f+=n,b.length-=n),b.length))break a;b.length=0;b.mode=7;case 7:if(b.flags&2048){if(0===
k)break a;n=0;do q=d[f+n++],b.head&&q&&65536>b.length&&(b.head.name+=String.fromCharCode(q));while(q&&n<k);b.flags&512&&(b.check=O(b.check,d,n,f));k-=n;f+=n;if(q)break a}else b.head&&(b.head.name=null);b.length=0;b.mode=8;case 8:if(b.flags&4096){if(0===k)break a;n=0;do q=d[f+n++],b.head&&q&&65536>b.length&&(b.head.comment+=String.fromCharCode(q));while(q&&n<k);b.flags&512&&(b.check=O(b.check,d,n,f));k-=n;f+=n;if(q)break a}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(b.flags&512){for(;16>
m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}if(l!==(b.check&65535)){a.msg="header crc mismatch";b.mode=30;break}m=l=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0);a.adler=b.check=0;b.mode=12;break;case 10:for(;32>m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}a.adler=b.check=lb(l);m=l=0;b.mode=11;case 11:if(0===b.havedict)return a.next_out=g,a.avail_out=h,a.next_in=f,a.avail_in=k,b.hold=l,b.bits=m,2;a.adler=b.check=1;b.mode=12;case 12:if(5===c||6===c)break a;case 13:if(b.last){l>>>=m&7;m-=m&7;b.mode=
27;break}for(;3>m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}b.last=l&1;l>>>=1;--m;switch(l&3){case 0:b.mode=14;break;case 1:q=b;if(xb){Na=new A.Buf32(512);Oa=new A.Buf32(32);for(n=0;144>n;)q.lens[n++]=8;for(;256>n;)q.lens[n++]=9;for(;280>n;)q.lens[n++]=7;for(;288>n;)q.lens[n++]=8;wa(1,q.lens,0,288,Na,0,q.work,{bits:9});for(n=0;32>n;)q.lens[n++]=5;wa(2,q.lens,0,32,Oa,0,q.work,{bits:5});xb=!1}q.lencode=Na;q.lenbits=9;q.distcode=Oa;q.distbits=5;b.mode=20;if(6===c){l>>>=2;m-=2;break a}break;case 2:b.mode=
17;break;case 3:a.msg="invalid block type",b.mode=30}l>>>=2;m-=2;break;case 14:l>>>=m&7;for(m-=m&7;32>m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}if((l&65535)!==(l>>>16^65535)){a.msg="invalid stored block lengths";b.mode=30;break}b.length=l&65535;m=l=0;b.mode=15;if(6===c)break a;case 15:b.mode=16;case 16:if(n=b.length){n>k&&(n=k);n>h&&(n=h);if(0===n)break a;A.arraySet(e,d,f,n,g);k-=n;f+=n;h-=n;g+=n;b.length-=n;break}b.mode=12;break;case 17:for(;14>m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}b.nlen=
(l&31)+257;l>>>=5;m-=5;b.ndist=(l&31)+1;l>>>=5;m-=5;b.ncode=(l&15)+4;l>>>=4;m-=4;if(286<b.nlen||30<b.ndist){a.msg="too many length or distance symbols";b.mode=30;break}b.have=0;b.mode=18;case 18:for(;b.have<b.ncode;){for(;3>m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}b.lens[C[b.have++]]=l&7;l>>>=3;m-=3}for(;19>b.have;)b.lens[C[b.have++]]=0;b.lencode=b.lendyn;b.lenbits=7;n={bits:b.lenbits};S=wa(0,b.lens,0,19,b.lencode,0,b.work,n);b.lenbits=n.bits;if(S){a.msg="invalid code lengths set";b.mode=30;break}b.have=
0;b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;;){p=b.lencode[l&(1<<b.lenbits)-1];n=p>>>24;p&=65535;if(n<=m)break;if(0===k)break a;k--;l+=d[f++]<<m;m+=8}if(16>p)l>>>=n,m-=n,b.lens[b.have++]=p;else{if(16===p){for(q=n+2;m<q;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}l>>>=n;m-=n;if(0===b.have){a.msg="invalid bit length repeat";b.mode=30;break}q=b.lens[b.have-1];n=3+(l&3);l>>>=2;m-=2}else if(17===p){for(q=n+3;m<q;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}l>>>=n;m-=n;q=0;n=3+(l&7);l>>>=3;m-=3}else{for(q=
n+7;m<q;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}l>>>=n;m-=n;q=0;n=11+(l&127);l>>>=7;m-=7}if(b.have+n>b.nlen+b.ndist){a.msg="invalid bit length repeat";b.mode=30;break}for(;n--;)b.lens[b.have++]=q}}if(30===b.mode)break;if(0===b.lens[256]){a.msg="invalid code -- missing end-of-block";b.mode=30;break}b.lenbits=9;n={bits:b.lenbits};S=wa(1,b.lens,0,b.nlen,b.lencode,0,b.work,n);b.lenbits=n.bits;if(S){a.msg="invalid literal/lengths set";b.mode=30;break}b.distbits=6;b.distcode=b.distdyn;n={bits:b.distbits};
S=wa(2,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,n);b.distbits=n.bits;if(S){a.msg="invalid distances set";b.mode=30;break}b.mode=20;if(6===c)break a;case 20:b.mode=21;case 21:if(6<=k&&258<=h){a.next_out=g;a.avail_out=h;a.next_in=f;a.avail_in=k;b.hold=l;b.bits=m;var x,z,D,H,G,I,F,J,E,L,Q=a;L=Q.state;E=Q.next_in;e=Q.input;J=E+(Q.avail_in-5);F=Q.next_out;d=Q.output;I=F-(B-Q.avail_out);G=F+(Q.avail_out-257);H=L.dmax;p=L.wsize;u=L.whave;v=L.wnext;y=L.window;q=L.hold;n=L.bits;m=L.lencode;l=L.distcode;h=
(1<<L.lenbits)-1;k=(1<<L.distbits)-1;b:do c:for(15>n&&(q+=e[E++]<<n,n+=8,q+=e[E++]<<n,n+=8),x=m[q&h];;){g=x>>>24;q>>>=g;n-=g;g=x>>>16&255;if(0===g)d[F++]=x&65535;else if(g&16){f=x&65535;if(g&=15)n<g&&(q+=e[E++]<<n,n+=8),f+=q&(1<<g)-1,q>>>=g,n-=g;15>n&&(q+=e[E++]<<n,n+=8,q+=e[E++]<<n,n+=8);x=l[q&k];d:for(;;){g=x>>>24;q>>>=g;n-=g;g=x>>>16&255;if(g&16){D=x&65535;g&=15;n<g&&(q+=e[E++]<<n,n+=8,n<g&&(q+=e[E++]<<n,n+=8));D+=q&(1<<g)-1;if(D>H){Q.msg="invalid distance too far back";L.mode=30;break b}q>>>=
g;n-=g;g=F-I;if(D>g){g=D-g;if(g>u&&L.sane){Q.msg="invalid distance too far back";L.mode=30;break b}z=0;x=y;if(0===v){if(z+=p-g,g<f){f-=g;do d[F++]=y[z++];while(--g);z=F-D;x=d}}else if(v<g){if(z+=p+v-g,g-=v,g<f){f-=g;do d[F++]=y[z++];while(--g);z=0;if(v<f){g=v;f-=g;do d[F++]=y[z++];while(--g);z=F-D;x=d}}}else if(z+=v-g,g<f){f-=g;do d[F++]=y[z++];while(--g);z=F-D;x=d}for(;2<f;)d[F++]=x[z++],d[F++]=x[z++],d[F++]=x[z++],f-=3;f&&(d[F++]=x[z++],1<f&&(d[F++]=x[z++]))}else{z=F-D;do d[F++]=d[z++],d[F++]=d[z++],
d[F++]=d[z++],f-=3;while(2<f);f&&(d[F++]=d[z++],1<f&&(d[F++]=d[z++]))}}else if(0===(g&64)){x=l[(x&65535)+(q&(1<<g)-1)];continue d}else{Q.msg="invalid distance code";L.mode=30;break b}break}}else if(0===(g&64)){x=m[(x&65535)+(q&(1<<g)-1)];continue c}else{g&32?L.mode=12:(Q.msg="invalid literal/length code",L.mode=30);break b}break}while(E<J&&F<G);f=n>>3;E-=f;n-=f<<3;Q.next_in=E;Q.next_out=F;Q.avail_in=E<J?5+(J-E):5-(E-J);Q.avail_out=F<G?257+(G-F):257-(F-G);L.hold=q&(1<<n)-1;L.bits=n;g=a.next_out;e=
a.output;h=a.avail_out;f=a.next_in;d=a.input;k=a.avail_in;l=b.hold;m=b.bits;12===b.mode&&(b.back=-1);break}for(b.back=0;;){p=b.lencode[l&(1<<b.lenbits)-1];n=p>>>24;q=p>>>16&255;p&=65535;if(n<=m)break;if(0===k)break a;k--;l+=d[f++]<<m;m+=8}if(q&&0===(q&240)){y=n;v=q;for(u=p;;){p=b.lencode[u+((l&(1<<y+v)-1)>>y)];n=p>>>24;q=p>>>16&255;p&=65535;if(y+n<=m)break;if(0===k)break a;k--;l+=d[f++]<<m;m+=8}l>>>=y;m-=y;b.back+=y}l>>>=n;m-=n;b.back+=n;b.length=p;if(0===q){b.mode=26;break}if(q&32){b.back=-1;b.mode=
12;break}if(q&64){a.msg="invalid literal/length code";b.mode=30;break}b.extra=q&15;b.mode=22;case 22:if(b.extra){for(q=b.extra;m<q;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}b.length+=l&(1<<b.extra)-1;l>>>=b.extra;m-=b.extra;b.back+=b.extra}b.was=b.length;b.mode=23;case 23:for(;;){p=b.distcode[l&(1<<b.distbits)-1];n=p>>>24;q=p>>>16&255;p&=65535;if(n<=m)break;if(0===k)break a;k--;l+=d[f++]<<m;m+=8}if(0===(q&240)){y=n;v=q;for(u=p;;){p=b.distcode[u+((l&(1<<y+v)-1)>>y)];n=p>>>24;q=p>>>16&255;p&=65535;if(y+
n<=m)break;if(0===k)break a;k--;l+=d[f++]<<m;m+=8}l>>>=y;m-=y;b.back+=y}l>>>=n;m-=n;b.back+=n;if(q&64){a.msg="invalid distance code";b.mode=30;break}b.offset=p;b.extra=q&15;b.mode=24;case 24:if(b.extra){for(q=b.extra;m<q;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}b.offset+=l&(1<<b.extra)-1;l>>>=b.extra;m-=b.extra;b.back+=b.extra}if(b.offset>b.dmax){a.msg="invalid distance too far back";b.mode=30;break}b.mode=25;case 25:if(0===h)break a;n=B-h;if(b.offset>n){n=b.offset-n;if(n>b.whave&&b.sane){a.msg="invalid distance too far back";
b.mode=30;break}n>b.wnext?(n-=b.wnext,q=b.wsize-n):q=b.wnext-n;n>b.length&&(n=b.length);y=b.window}else y=e,q=g-b.offset,n=b.length;n>h&&(n=h);h-=n;b.length-=n;do e[g++]=y[q++];while(--n);0===b.length&&(b.mode=21);break;case 26:if(0===h)break a;e[g++]=b.length;h--;b.mode=21;break;case 27:if(b.wrap){for(;32>m;){if(0===k)break a;k--;l|=d[f++]<<m;m+=8}B-=h;a.total_out+=B;b.total+=B;B&&(a.adler=b.check=b.flags?O(b.check,e,B,g-B):qa(b.check,e,B,g-B));B=h;if((b.flags?l:lb(l))!==b.check){a.msg="incorrect data check";
b.mode=30;break}m=l=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;32>m;){if(0===k)break a;k--;l+=d[f++]<<m;m+=8}if(l!==(b.total&4294967295)){a.msg="incorrect length check";b.mode=30;break}m=l=0}b.mode=29;case 29:S=1;break a;case 30:S=-3;break a;case 31:return-4;default:return-2}a.next_out=g;a.avail_out=h;a.next_in=f;a.avail_in=k;b.hold=l;b.bits=m;if((b.wsize||B!==a.avail_out&&30>b.mode&&(27>b.mode||4!==c))&&qb(a,a.output,a.next_out,B-a.avail_out))return b.mode=31,-4;t-=a.avail_in;B-=a.avail_out;a.total_in+=
t;a.total_out+=B;b.total+=B;b.wrap&&B&&(a.adler=b.check=b.flags?O(b.check,e,B,a.next_out-B):qa(b.check,e,B,a.next_out-B));a.data_type=b.bits+(b.last?64:0)+(12===b.mode?128:0)+(20===b.mode||15===b.mode?256:0);(0===t&&0===B||4===c)&&0===S&&(S=-5);return S},inflateEnd:function(a){if(!a||!a.state)return-2;var c=a.state;c.window&&(c.window=null);a.state=null;return 0},inflateGetHeader:function(a,c){var b;if(!a||!a.state)return-2;b=a.state;if(0===(b.wrap&2))return-2;b.head=c;c.done=!1;return 0},inflateSetDictionary:function(a,
c){var b=c.length,d,e;if(!a||!a.state)return-2;d=a.state;if(0!==d.wrap&&11!==d.mode)return-2;if(11===d.mode&&(e=qa(1,c,b,0),e!==d.check))return-3;if(qb(a,c,b,b))return d.mode=31,-4;d.havedict=1;return 0},inflateInfo:"pako inflate (from Nodeca project)"},I={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,
Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Eb=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1},yb=Object.prototype.toString;la.prototype.push=function(a,c){var b=this.strm,d=this.options.chunkSize,e=this.options.dictionary,f,g,k,h,l,m=!1;if(this.ended)return!1;g=c===~~c?c:!0===c?I.Z_FINISH:I.Z_NO_FLUSH;"string"===typeof a?b.input=V.binstring2buf(a):
"[object ArrayBuffer]"===yb.call(a)?b.input=new Uint8Array(a):b.input=a;b.next_in=0;b.avail_in=b.input.length;do{0===b.avail_out&&(b.output=new A.Buf8(d),b.next_out=0,b.avail_out=d);f=sa.inflate(b,I.Z_NO_FLUSH);f===I.Z_NEED_DICT&&e&&(f="string"===typeof e?V.string2buf(e):"[object ArrayBuffer]"===yb.call(e)?new Uint8Array(e):e,f=sa.inflateSetDictionary(this.strm,f));f===I.Z_BUF_ERROR&&!0===m&&(f=I.Z_OK,m=!1);if(f!==I.Z_STREAM_END&&f!==I.Z_OK)return this.onEnd(f),this.ended=!0,!1;if(b.next_out&&(0===
b.avail_out||f===I.Z_STREAM_END||0===b.avail_in&&(g===I.Z_FINISH||g===I.Z_SYNC_FLUSH)))if("string"===this.options.to)k=V.utf8border(b.output,b.next_out),h=b.next_out-k,l=V.buf2string(b.output,k),b.next_out=h,b.avail_out=d-h,h&&A.arraySet(b.output,b.output,k,h,0),this.onData(l);else this.onData(A.shrinkBuf(b.output,b.next_out));0===b.avail_in&&0===b.avail_out&&(m=!0)}while((0<b.avail_in||0===b.avail_out)&&f!==I.Z_STREAM_END);f===I.Z_STREAM_END&&(g=I.Z_FINISH);if(g===I.Z_FINISH)return f=sa.inflateEnd(this.strm),
this.onEnd(f),this.ended=!0,f===I.Z_OK;g===I.Z_SYNC_FLUSH&&(this.onEnd(I.Z_OK),b.avail_out=0);return!0};la.prototype.onData=function(a){this.chunks.push(a)};la.prototype.onEnd=function(a){a===I.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):A.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};var Nb=A.assign,ma={};Nb(ma,Hb,{Inflate:la,inflate:Ma,inflateRaw:function(a,c){c=c||{};c.raw=!0;return Ma(a,c)},ungzip:Ma},I);var xa=function(){var a;a=v.call(this)||
this;a._outputCounter=0;return a};$jscomp.inherits(xa,v);xa.prototype._run=function(){var a=this;this._outputCounter=0;this.getInputCategories().forEach(function(c){a._loadFile(c)})};xa.prototype._loadFile=function(a){var c=this,b=new FileReader;b.onloadend=function(b){b=b.target.result;if(c._getInput(a).name.split(".").pop().localeCompare("pixp"))try{b=ma.inflate(b).buffer,console.log("File was un-gziped successfully")}catch(e){console.log("Pako: "+e+" (this content is not gziped)")}c._output[a]=
b;c._fileLoadCount()};b.onerror=function(){this._output[a]=null;c._fileLoadCount();console.warn("error reading file from category "+a)};b.readAsArrayBuffer(this._getInput(a))};xa.prototype._fileLoadCount=function(){this._outputCounter++;this._outputCounter==this.getNumberOfInputs()&&this._events.ready(this)};var Ea=function(){var a;a=v.call(this)||this;a._outputCounter=0;return a};$jscomp.inherits(Ea,v);Ea.prototype._run=function(){var a=this;this.getNumberOfInputs()?this._forEachInput(function(c,
b){a._loadUrl(c,b)}):console.warn("No input was specified, cannot run this filer.")};Ea.prototype._loadUrl=function(a,c){var b=this,d=new XMLHttpRequest;d.open("GET",c,!0);d.responseType="arraybuffer";d.onload=function(e){e=d.response;if(c.split(".").pop().localeCompare("pixp"))try{e=ma.inflate(e).buffer,console.log("File was un-gziped successfully")}catch(f){console.log("Pako: "+f+" (this content is not gziped)")}b._output[a]=e;b._outputCounter++;b._outputCounter==b.getNumberOfInputs()&&"ready"in
b._events&&b._events.ready(b)};d.error=function(){console.log("here go the error")};d.send()};var p=function(){var a;a=v.call(this)||this;a.setMetadata("debug",!1);a._type_enum={INT8:1,UINT8:2,INT16:3,UINT16:4,INT32:5,UINT32:6,FLT:7,DBL:8,STR:9};a._type_matching="int8 uint8 int16 uint16 int32 uint32 float32 float64 undef".split(" ");a.type_sizes=[0,1,1,2,2,4,4,4,8,0];a._dv_offset=0;a._align=8;a._little_endian=!0;a._continuation_queue=[];a._dv=null;a._superblk={};a._start_offset=0;a._huge_id=0;return a};
$jscomp.inherits(p,v);p.prototype.createLink=function(){return{hdr_offset:0,data_offset:0,data_length:0,n_filled:0,chunk_size:0,sym_btree:0,sym_lheap:0,name:"",attributes:{},children:[],array:void 0,type:-1,inflate:!1,dims:[]}};p.prototype.startAlignment=function(){this._start_offset=this._dv_offset};p.prototype.checkAlignment=function(){var a=this._dv_offset-this._start_offset;if(0!==a%this._align){var c=this._align-a%this._align;this._dv_offset+=c;this.getMetadata("debug")&&console.log("skipping "+
c+" bytes at "+a+" for alignmnent")}};p.prototype.skip=function(a){this._dv_offset+=a};p.prototype.seek=function(a){this._dv_offset=a};p.prototype.tell=function(){return this._dv_offset};p.prototype.getU8=function(){var a=this._dv.getUint8(this._dv_offset);this._dv_offset+=1;return a};p.prototype.getU16=function(){var a=this._dv.getUint16(this._dv_offset,this._little_endian);this._dv_offset+=2;return a};p.prototype.getU32=function(){var a=this._dv.getUint32(this._dv_offset,this._little_endian);this._dv_offset+=
4;return a};p.prototype.getU64=function(){var a=this._dv.getUint64(this._dv_offset,this._little_endian);this._dv_offset+=8;return a};p.prototype.getF32=function(){var a=this._dv.getFloat32(this._dv_offset,this._little_endian);this._dv_offset+=4;return a};p.prototype.getF64=function(){var a=this._dv.getFloat64(this._dv_offset,this._little_endian);this._dv_offset+=8;return a};p.prototype.getOffset=function(a){var c;a=a||this._superblk.offsz;if(4===a)c=this._dv.getUint32(this._dv_offset,this._little_endian);
else if(8===a)c=this._dv.getUint64(this._dv_offset,this._little_endian);else throw Error("Unsupported value for offset size "+a);this._dv_offset+=a;return c};p.prototype.getLength=function(){var a=this._dv.getUint64(this._dv_offset,this._little_endian);this._dv_offset+=this._superblk.lensz;return a};p.prototype.getString=function(a){var c="",b,d;for(b=0;b<a;b+=1){d=this.getU8();if(0===d){this._dv_offset+=a-b-1;break}c+=String.fromCharCode(d)}return c};p.prototype.getArray=function(a,c,b){var d=this._getInput(),
e=this._dv_offset;b&&(this._dv_offset=b);switch(a){case this._type_enum.INT8:a=new Int8Array(d,this._dv_offset,c);break;case this._type_enum.UINT8:a=new Uint8Array(d,this._dv_offset,c);break;case this._type_enum.INT16:if(0!==this._dv_offset%2)for(a=new ArrayBuffer(c),c/=2,a=new Int16Array(a),d=0;d<c;d+=1)a[d]=this.getU16();else a=new Int16Array(d,this._dv_offset,c/2),this._dv_offset+=c;break;case this._type_enum.UINT16:if(0!==this._dv_offset%2)for(a=new ArrayBuffer(c),c/=2,a=new Uint16Array(a),d=
0;d<c;d+=1)a[d]=this.getU16();else a=new Uint16Array(d,this._dv_offset,c/2),this._dv_offset+=c;break;case this._type_enum.INT32:if(0!==this._dv_offset%4)for(a=new ArrayBuffer(c),c/=4,a=new Int32Array(a),d=0;d<c;d+=1)a[d]=this.getU32();else a=new Int32Array(d,this._dv_offset,c/4),this._dv_offset+=c;break;case this._type_enum.UINT32:if(0!==this._dv_offset%4)for(a=new ArrayBuffer(c),c/=4,a=new Uint32Array(a),d=0;d<c;d+=1)a[d]=this.getU32();else a=new Uint32Array(d,this._dv_offset,c/4),this._dv_offset+=
c;break;case this._type_enum.FLT:if(0!==this._dv_offset%4)for(a=new ArrayBuffer(c),c/=4,a=new Float32Array(a),d=0;d<c;d+=1)a[d]=this.getF32();else a=new Float32Array(d,this._dv_offset,c/4),this._dv_offset+=c;break;case this._type_enum.DBL:if(0!==this._dv_offset%8)for(a=new ArrayBuffer(c),c/=8,a=new Float64Array(a),d=0;d<c;d+=1)a[d]=this.getF64();else a=new Float64Array(d,this._dv_offset,c/8),this._dv_offset+=c;break;default:throw Error("Bad type in this.getArray "+a);}b&&(this._dv_offset=e);return a};
p.prototype.getUXX=function(a){var c,b;switch(a){case 1:c=this._dv.getUint8(this._dv_offset);break;case 2:c=this._dv.getUint16(this._dv_offset,this._little_endian);break;case 4:c=this._dv.getUint32(this._dv_offset,this._little_endian);break;case 8:c=this._dv.getUint64(this._dv_offset,this._little_endian);break;default:if(c=0,this._little_endian)for(b=a-1;0<=b;b--)c=(c<<8)+this._dv.getUint8(this._dv_offset+b);else for(b=0;b<a;b++)c=(c<<8)+this._dv.getUint8(this._dv_offset+b)}this._dv_offset+=a;return c};
p.prototype.checkSignature=function(a){var c;for(c=0;c<a.length;c+=1)if(this._dv.getUint8(this._dv_offset+c)!==a.charCodeAt(c))return!1;this.skip(a.length);return!0};p.prototype.hdf5Superblock=function(){var a={};if(!this.checkSignature("\u0089HDF\r\n\u001a\n"))throw Error("Bad magic string in HDF5");a.sbver=this.getU8();if(2<a.sbver)throw Error("Unsupported HDF5 superblock version "+a.sbver);1>=a.sbver?(a.fsver=this.getU8(),a.rgver=this.getU8(),this.skip(1),a.shver=this.getU8(),a.offsz=this.getU8(),
a.lensz=this.getU8(),this.skip(1),a.gln_k=this.getU16(),a.gin_k=this.getU16(),a.cflags=this.getU32(),1===a.sbver&&(a.isin_k=this.getU16(),this.skip(2)),a.base_addr=this.getOffset(a.offsz),a.gfsi_addr=this.getOffset(a.offsz),a.eof_addr=this.getOffset(a.offsz),a.dib_addr=this.getOffset(a.offsz),a.root_ln_offs=this.getOffset(a.offsz),a.root_addr=this.getOffset(a.offsz),a.root_cache_type=this.getU32(),this.skip(4),this.skip(16)):(a.offsz=this.getU8(),a.lensz=this.getU8(),a.cflags=this.getU8(),a.base_addr=
this.getOffset(a.offsz),a.ext_addr=this.getOffset(a.offsz),a.eof_addr=this.getOffset(a.offsz),a.root_addr=this.getOffset(a.offsz),a.checksum=this.getU32());this.getMetadata("debug")&&console.log("HDF5 SB "+a.sbver+" "+a.offsz+" "+a.lensz+" "+a.cflags);return a};p.prototype.hdf5FractalHeapHeader=function(){var a={};if(!this.checkSignature("FRHP"))throw Error("Bad or missing FRHP signature");a.ver=this.getU8();a.idlen=this.getU16();a.iof_el=this.getU16();a.flags=this.getU8();a.objmax=this.getU32();
a.objnid=this.getLength();a.objbta=this.getOffset();a.nf_blk=this.getLength();a.af_blk=this.getOffset();a.heap_total=this.getLength();a.heap_alloc=this.getLength();a.bai_offset=this.getLength();a.heap_nobj=this.getLength();a.heap_chuge=this.getLength();a.heap_nhuge=this.getLength();a.heap_ctiny=this.getLength();a.heap_ntiny=this.getLength();a.table_width=this.getU16();a.start_blksz=this.getLength();a.max_blksz=this.getLength();a.max_heapsz=this.getU16();a.rib_srows=this.getU16();a.root_addr=this.getOffset();
a.rib_crows=this.getU16();var c=Math.log2(a.max_blksz)-Math.log2(a.start_blksz)+2;a.K=Math.min(a.rib_crows,c)*a.table_width;a.N=a.rib_crows<c?0:a.K-c*a.table_width;this.getMetadata("debug")&&(console.log("FRHP V"+a.ver+" F"+a.flags+" "+a.objbta+" Total:"+a.heap_total+" Alloc:"+a.heap_alloc+" #obj:"+a.heap_nobj+" width:"+a.table_width+" start_blksz:"+a.start_blksz+" max_blksz:"+a.max_blksz+" "+a.max_heapsz+" srows:"+a.rib_srows+" crows:"+a.rib_crows+" "+a.heap_nhuge),console.log("   K: "+a.K+" N: "+
a.N));if(0<a.iof_el)throw Error("Filters present in fractal heap.");return a};p.prototype.hdf5V2BtreeHeader=function(){var a={};if(!this.checkSignature("BTHD"))throw Error("Bad or missing BTHD signature");a.ver=this.getU8();a.type=this.getU8();a.nodesz=this.getU32();a.recsz=this.getU16();a.depth=this.getU16();a.splitp=this.getU8();a.mergep=this.getU8();a.root_addr=this.getOffset();a.root_nrec=this.getU16();a.total_nrec=this.getLength();a.checksum=this.getU32();this.getMetadata("debug")&&console.log("BTHD V"+
a.ver+" T"+a.type+" "+a.nodesz+" "+a.recsz+" "+a.depth+" "+a.root_addr+" "+a.root_nrec+" "+a.total_nrec);return a};p.prototype.hdf5V2BtreeRecords=function(a,c,b,d){var e,f,g;if(1===c)for(c=0;c<b;c++)f=this.getOffset(),g=this.getLength(),a=this.getLength(),this.getMetadata("debug")&&console.log("  -> "+f+" "+g+" "+a+" "+this._this._huge_id),e=this.tell(),a===this._this._huge_id&&(this.seek(f),this.hdf5MsgAttribute(g,d)),this.seek(e);else if(8===c){var k,h;k=a.max_heapsz/8;c=Math.min(a.objmax,a.max_blksz);
h=256>=c?1:65536>=c?2:4;for(c=0;c<b;c++){e=this.getU8();if(0!==(e&192))throw Error("Bad Fractal Heap ID version "+e);var l=e&48,m;if(16===l)this._this._huge_id=this.getUXX(7);else if(0===l)f=this.getUXX(k),g=this.getUXX(h);else throw Error("Can't handle this Heap ID: "+e);m=this.getU8();this.getU32();this.getU32();this.getMetadata("debug")&&console.log("  -> "+e+" "+f+" "+g+" "+m);e=this.tell();if(16===l)if(this.seek(a.objbta),l=this.hdf5V2BtreeHeader(),1===l.type)this.seek(l.root_addr),this.hdf5V2BtreeLeafNode(a,
l.root_nrec,d);else throw Error("Can only handle type-1 btrees");else l=this.hdf5FractalHeapOffset(a,f),this.seek(l),this.hdf5MsgAttribute(g,d);this.seek(e)}}else throw Error("Unhandled V2 btree type.");};p.prototype.hdf5V2BtreeLeafNode=function(a,c,b){if(!this.checkSignature("BTLF"))throw Error("Bad or missing BTLF signature");var d=this.getU8(),e=this.getU8();this.getMetadata("debug")&&console.log("BTLF V"+d+" T"+e+" "+this.tell());this.hdf5V2BtreeRecords(a,e,c,b)};p.prototype.hdf5V2BtreeInternalNode=
function(a,c,b,d){if(!this.checkSignature("BTIN"))throw Error("Bad or missing BTIN signature");var e=this.getU8(),f=this.getU8();this.getMetadata("debug")&&console.log("BTIN V"+e+" T"+f);this.hdf5V2BtreeRecords(a,f,c,d);for(a=0;a<=c;a++){d=this.getOffset();var e=this.getUXX(1),g;1<b&&(g=this.getUXX(1));this.getMetadata("debug")&&console.log(" child->"+d+" "+e+" "+g)}};p.prototype.hdf5GetMsgName=function(a){var c="NIL;Dataspace;LinkInfo;Datatype;FillValue 1;FillValue 2;Link;ExternalFiles;Layout;BOGUS;GroupInfo;FilterPipeline;Attribute;ObjectComment;ObjectModTime 1;SharedMsgTable;ObjHdrContinue;SymbolTable;ObjectModTime 2;BtreeKValue;DriverInfo;AttrInfo;ObjectRefCnt;MESSAGE23;FileSpaceInfo".split(";");
if(a<c.length)return c[a];throw Error("Unknown message type "+a+" "+this.tell());};p.prototype.hdf5V1BtreeNode=function(a){var c=this._getInput(),b,d={};if(!this.checkSignature("TREE"))throw Error("Bad TREE signature at "+this.tell());d.keys=[];d.node_type=this.getU8();d.node_level=this.getU8();d.entries_used=this.getU16();d.left_sibling=this.getOffset();d.right_sibling=this.getOffset();this.getMetadata("debug")&&console.log("BTREE type "+d.node_type+" lvl "+d.node_level+" n_used "+d.entries_used+
" "+d.left_sibling+" "+d.right_sibling);if(a){var e,f=[];for(b=0;b<d.entries_used;b+=1){d.keys[b]={};f[b]={};f[b].chunk_size=this.getU32();f[b].filter_mask=this.getU32();f[b].chunk_offsets=[];for(e=0;e<a.dims.length+1;e+=1)f[b].chunk_offsets.push(this.getU64());d.keys[b].child_address=this.getOffset();b<d.entries_used&&this.getMetadata("debug")&&console.log("  BTREE "+b+" chunk_size "+f[b].chunk_size+" filter_mask "+f[b].filter_mask+" addr "+d.keys[b].child_address)}f[b]={};f[b].chunk_size=this.getU32();
f[b].filter_mask=this.getU32();f[b].chunk_offsets=[];for(e=0;e<a.dims.length+1;e+=1)f[b].chunk_offsets.push(this.getU64());if(0===d.node_level){var g;for(b=0;b<d.entries_used;b+=1)if(e=f[b].chunk_size,g=d.keys[b].child_address,a.inflate){e=new Uint8Array(c,g,e);g=ma.inflate(e);switch(a.type){case this._type_enum.INT8:g=new Int8Array(g.buffer);break;case this._type_enum.UINT8:g=new Uint8Array(g.buffer);break;case this._type_enum.INT16:g=new Int16Array(g.buffer);break;case this._type_enum.UINT16:g=
new Uint16Array(g.buffer);break;case this._type_enum.INT32:g=new Int32Array(g.buffer);break;case this._type_enum.UINT32:g=new Uint32Array(g.buffer);break;case this._type_enum.FLT:g=new Float32Array(g.buffer);break;case this._type_enum.DBL:g=new Float64Array(g.buffer);break;default:throw Error("Unknown type code "+a.type);}a.array.length-a.n_filled<g.length&&(g=g.subarray(0,a.array.length-a.n_filled));a.array.set(g,a.n_filled);a.n_filled+=g.length;this.getMetadata("debug")&&console.log(a.name+" "+
e.length+" "+g.length+" "+a.n_filled+"/"+a.array.length)}else g=this.getArray(a.type,e,g),a.array.set(g,a.n_filled),a.n_filled+=g.length}else for(b=0;b<d.entries_used;b+=1)this.seek(d.keys[b].child_address),this.hdf5V1BtreeNode(a)}else for(b=0;b<d.entries_used;b+=1)d.keys[b]={},d.keys[b].key_value=this.getLength(),d.keys[b].child_address=this.getOffset(),this.getMetadata("debug")&&console.log("  BTREE "+b+" key "+d.keys[b].key_value+" adr "+d.keys[b].child_address);return d};p.prototype.hdf5GroupSymbolTable=
function(a,c){if(!this.checkSignature("SNOD"))throw Error("Bad or missing SNOD signature");var b=this.getU8();this.skip(1);var d=this.getU16();this.getMetadata("debug")&&console.log("this.hdf5GroupSymbolTable V"+b+" #"+d+" '"+c.name+"'");for(var e,f,g,k,h,b=0;b<2*this._superblk.gln_k;b+=1)e=this.getOffset(),f=this.getOffset(),g=this.getU32(),this.skip(20),b<d&&(k=this.createLink(),k.hdr_offset=f,a&&(h=this.tell(),this.seek(a.lh_dseg_off+e),k.name=this.getString(a.lh_dseg_len),this.seek(h)),this.getMetadata("debug")&&
console.log("    "+b+" O "+e+" A "+f+" T "+g+" '"+k.name+"'"),c.children.push(k))};p.prototype.hdf5LocalHeap=function(){var a={};if(!this.checkSignature("HEAP"))throw Error("Bad or missing HEAP signature");a.lh_ver=this.getU8();this.skip(3);a.lh_dseg_len=this.getLength();a.lh_flst_len=this.getLength();a.lh_dseg_off=this.getOffset();this.getMetadata("debug")&&console.log("LHEAP V"+a.lh_ver+" "+a.lh_dseg_len+" "+a.lh_flst_len+" "+a.lh_dseg_off);return a};p.prototype.hdf5MsgDataspace=function(a,c){var b,
d=this.getU8(),e=this.getU8(),f=this.getU8();1>=d?this.skip(5):this.skip(1);var g=1,k=[],h;for(h=0;h<e;h+=1)k[h]=this.getLength(),g*=k[h];b=e*this._superblk.lensz+(1>=d?8:4);if(0!==(f&1))for(b+=e*this._superblk.lensz,h=0;h<e;h+=1)this.getLength();if(0!==(f&2))for(b+=e*this._superblk.lensz,h=0;h<e;h+=1)this.getLength();d="this.hdf5MsgDataspace V"+d+" N"+e+" F"+f;this.getMetadata("debug")&&(0!==e&&(d+="["+k.join(", ")+"]"),console.log(d));b<a&&this.skip(a-b);c&&(c.dims=k);return g};p.prototype.hdf5MsgLinkInfo=
function(a){var c=this,b=this.getU8(),d=this.getU8();0!==(d&1)&&this.getU64();var e=this.getOffset(),f=this.getOffset();0!==(d&2)&&this.getOffset();this.getMetadata("debug")&&console.log("this.hdf5MsgLinkInfo V"+b+" F"+d+" FH "+e+" BT "+f);b=this.tell();if(e<this._superblk.eof_addr){this.seek(e);var g=this.hdf5FractalHeapHeader(),k=0;this.hdf5FractalHeapEnumerate(g,function(b,d,e,f){for(b=d+f;k<g.heap_nobj&&c.tell()<b;)c.hdf5MsgLink(a),k+=1;return!0})}this.seek(b)};p.prototype.dt_class_name=function(a){var c=
"Fixed-Point Floating-Point Time String BitField Opaque Compound Reference Enumerated Variable-Length Array".split(" ");if(a<c.length)return c[a];throw Error("Unknown datatype class: "+a);};p.prototype.hdf5MsgDatatype=function(a){var c={},b=8,d,e,f,g,k,h,l,m,p=this.getU8();d=p>>4;e=p&15;g=[];for(p=0;3>p;p+=1)g[p]=this.getU8();p=this.getU32();this.getMetadata("debug")&&console.log("this.hdf5MsgDatatype V"+d+" C"+e+" "+this.dt_class_name(e)+" "+g[0]+"."+g[1]+"."+g[2]+" "+p);switch(e){case 0:e=this.getU16();
f=this.getU16();switch(p){case 4:c.typ_type=g[0]&8?this._type_enum.INT32:this._type_enum.UINT32;break;case 2:c.typ_type=g[0]&8?this._type_enum.INT16:this._type_enum.UINT16;break;case 1:c.typ_type=g[0]&8?this._type_enum.INT8:this._type_enum.UINT8;break;default:throw Error("Unknown type size "+p);}c.typ_length=p;b+=4;this.getMetadata("debug")&&console.log("  ("+e+" "+f+")");break;case 1:d="";if(this.getMetadata("debug"))switch(g[0]&65){case 0:d+="LE ";break;case 1:d+="BE ";break;case 65:d+="VX ";break;
default:throw Error("Reserved fp byte order: "+g[0]);}e=this.getU16();f=this.getU16();g=this.getU8();k=this.getU8();h=this.getU8();l=this.getU8();m=this.getU32();this.getMetadata("debug")&&(d+=e+" "+f+" "+g+" "+k+" "+h+" "+l+" "+m);if(64===f&&0===e&&52===g&&11===k&&0===h&&52===l&&1023===m&&8===p)c.typ_type=this._type_enum.DBL;else if(32===f&&0===e&&23===g&&8===k&&0===h&&23===l&&127===m&&4===p)c.typ_type=this._type_enum.FLT;else throw Error("Unsupported floating-point type");this.getMetadata("debug")&&
console.log(d);c.typ_length=p;b+=12;break;case 3:c.typ_type=this._type_enum.STR;c.typ_length=p;break;default:throw Error("Unimplemented HDF5 data class "+e);}a>b&&this.skip(a-b);return c};p.prototype.hdf5MsgLayout=function(a){var c="",b=this.getU8(),d,e,f,g=[];f=1;if(1===b||2===b){e=this.getU8();d=this.getU8();this.skip(5);this.getMetadata("debug")&&(c+="this.hdf5MsgLayout V"+b+" N"+e+" C"+d);if(1===d||2===d)b=this.getOffset(),this.getMetadata("debug")&&(c+=" A"+b),a.data_offset=b;for(b=0;b<e;b+=
1)g[b]=this.getU32(),f*=g[b];this.getMetadata("debug")&&(c+="["+g.join(", ")+"]");2===d&&(e=this.getU32(),a.chunk_size=f*e,this.getMetadata("debug")&&(c+=" E"+e));0===d?(f=this.getU32(),this.getMetadata("debug")&&(c+="("+f+")"),a.data_offset=this.tell(),a.data_length=f):1===d&&(a.data_length=f)}else if(3===b)if(d=this.getU8(),c="this.hdf5MsgLayout V"+b+" C"+d,0===d)f=this.getU16(),this.getMetadata("debug")&&(c+="("+f+")"),a.data_offset=this.tell(),a.data_length=f;else if(1===d)d=this.getOffset(),
f=this.getLength(),this.getMetadata("debug")&&(c+="("+d+", "+f+")"),a.data_offset=d,a.data_length=f;else{if(2===d){e=this.getU8();d=this.getOffset();a.data_offset=d;a.chunk_size=1;for(b=0;b<e-1;b+=1)g[b]=this.getU32(),f*=g[b];this.getMetadata("debug")&&(c+="(N"+e+", A"+d+" ["+g.join(",")+"]");e=this.getU32();a.chunk_size=f*e;this.getMetadata("debug")&&(c+=" E"+e)}}else throw Error("Illegal layout version "+b);this.getMetadata("debug")&&console.log(c)};p.prototype.hdf5MsgPipeline=function(a){var c=
this.getU8(),b=this.getU8(),d="this.hdf5MsgPipeline V"+c+" N"+b;1===c&&this.skip(6);this.getMetadata("debug")&&console.log(d);for(var e,f,g,k,d=0;d<b;d+=1){e=this.getU16();if(1!==e)throw Error("Unimplemented HDF5 filter "+e);if("object"!==typeof ma)throw Error("Need pako to inflate data.");a.inflate=!0;f=1===c||256<e?this.getU16():0;g=this.getU16();k=this.getU16();0!==(k&1)&&(k+=1);0!==f&&this.skip(f);this.skip(4*k);this.getMetadata("debug")&&console.log("  "+d+" ID"+e+" F"+g+" "+k)}};p.prototype.hdf5MsgAttribute=
function(a,c){var b=this.getU8(),d=this.getU8(),e=this.getU16(),f=this.getU16(),g=this.getU16(),k="this.hdf5MsgAttribute V"+b+" F"+d+" "+a+": ";if(0!==(d&3))throw Error("Shared dataspaces and datatypes are not supported.");3===b&&(d=this.getU8(),this.getMetadata("debug")&&(k+=0===d?"ASCII":"UTF-8"));this.getMetadata("debug")&&(k+="("+e+" "+f+" "+g+")");3>b&&(e=8*Math.floor((e+7)/8),f=8*Math.floor((f+7)/8),g=8*Math.floor((g+7)/8),this.getMetadata("debug")&&(k+="/("+e+" "+f+" "+g+")"));d=this.getString(e);
this.getMetadata("debug")&&console.log(k+(" Name: "+d));var k=this.hdf5MsgDatatype(f),h=this.hdf5MsgDataspace(g),b=0<a?3>b?a-(8+e+f+g):a-(9+e+f+g):k.typ_length*h;this.getMetadata("debug")&&console.log("  attribute data size "+b+" "+this.tell());b=k.typ_type===this._type_enum.STR?this.getString(b):this.getArray(k.typ_type,b);c.attributes[d]=b};p.prototype.hdf5MsgGroupInfo=function(){var a=4,c=8,b=this.getU8(),d=this.getU8();0!==(d&1)&&(this.getU16(),this.getU16());0!==(d&2)&&(a=this.getU16(),c=this.getU16());
this.getMetadata("debug")&&console.log("this.hdf5MsgGroupInfo V"+b+" F"+d+" ENT "+a+" LNL "+c)};p.prototype.hdf5MsgLink=function(a){var c=this.getU8(),b=0;if(1!==c)throw Error("Bad link message version "+c);var d=this.getU8();0!==(d&8)&&(b=this.getU8());0!==(d&4)&&this.getU64();0!==(d&16)&&this.getU8();var e=this.getUXX(1<<(d&3)),f=this.createLink();f.name=this.getString(e);0===(d&8)&&(f.hdr_offset=this.getOffset());this.getMetadata("debug")&&console.log("this.hdf5MsgLink V"+c+" F"+d+" T"+b+" NM "+
f.name+" OF "+f.hdr_offset);a.children.push(f)};p.prototype.hdf5FractalHeapDirectBlock=function(a,c,b,d){if(!this.checkSignature("FHDB"))throw Error("Bad or missing FHDB signature");var e=this.getU8();if(0!==e)throw Error("Bad FHDB version: "+e);this.getOffset();var f=this.getUXX(Math.ceil(a.max_heapsz/8));0!==(a.flags&2)&&this.getU32();this.getMetadata("debug")&&console.log("FHDB V:"+e+" R:"+c+" O:"+f+" A:"+b);a=1>=c?a.start_blksz:Math.pow(2,c-1)*a.start_blksz;return d?d(c,b,f,a):!0};p.prototype.hdf5FractalHeapIndirectBlock=
function(a,c){if(!this.checkSignature("FHIB"))throw Error("Bad or missing FHIB signature");var b=this.getU8();if(0!==b)throw Error("Bad FHIB version: "+b);this.getOffset();var d=this.getUXX(Math.ceil(a.max_heapsz/8));this.getMetadata("debug")&&console.log("FHIB V:"+b+" O:"+d);for(var e=[],b=0;b<a.K;b+=1)d=this.getOffset(),d<this._superblk.eof_addr&&(this.getMetadata("debug")&&console.log("direct block at "+d),e.push(d));for(var f=[],b=0;b<a.N;b+=1)d=this.getOffset(),d<this._superblk.eof_addr&&(this.getMetadata("debug")&&
console.log("indirect block at "+d),f.push(d));this.getU32();for(b=0;b<e.length;b++)if(this.seek(e[b]),!this.hdf5FractalHeapDirectBlock(a,b/a.table_width,e[b],c))return!1;for(b=0;b<f.length;b++)if(this.seek(f[b]),!this.hdf5FractalHeapIndirectBlock(a,c))return!1;return!0};p.prototype.hdf5FractalHeapEnumerate=function(a,c){this.seek(a.root_addr);0===a.K?this.hdf5FractalHeapDirectBlock(a,0,a.root_addr,c):this.hdf5FractalHeapIndirectBlock(a,c)};p.prototype.hdf5FractalHeapOffset=function(a,c){var b;this.hdf5FractalHeapEnumerate(a,
function(a,e,f,g){return c>=f&&c<f+g?(b=e+(c-f),!1):!0});return b};p.prototype.hdf5MsgAttrInfo=function(a){var c=this.getU8();if(0!==c)throw Error("Bad attribute information message version: "+c);var b=this.getU8();0!==(b&1)&&this.getU16();var d=this.getOffset(),e=this.getOffset();0!==(b&2)&&this.getOffset();this.getMetadata("debug")&&console.log("this.hdf5MsgAttrInfo V"+c+" F"+b+" HP "+d+" AN "+e);var c=this.tell(),f;d<this._superblk.eof_addr&&(this.seek(d),f=this.hdf5FractalHeapHeader());if(e<this._superblk.eof_addr){this.seek(e);
d=this.hdf5V2BtreeHeader();if(8!==d.type)throw Error("Can only handle indexed attributes.");this.seek(d.root_addr);0<d.depth?this.hdf5V2BtreeInternalNode(f,d.root_nrec,d.depth,a):this.hdf5V2BtreeLeafNode(f,d.root_nrec,a)}this.seek(c)};p.prototype.hdf5ProcessMessage=function(a,c){var b={};switch(a.hm_type){case 1:this.hdf5MsgDataspace(a.hm_size,c);break;case 2:this.hdf5MsgLinkInfo(c);break;case 3:b=this.hdf5MsgDatatype(a.hm_size);c&&(c.type=b.typ_type);break;case 6:this.hdf5MsgLink(c);break;case 8:this.hdf5MsgLayout(c);
break;case 10:this.hdf5MsgGroupInfo();break;case 11:this.hdf5MsgPipeline(c);break;case 12:this.hdf5MsgAttribute(a.hm_size,c);break;case 16:b.cq_off=this.getOffset();b.cq_len=this.getLength();this._continuation_queue.push(b);this.getMetadata("debug")&&console.log("hdf5MsgObjHdrContinue "+b.cq_off+" "+b.cq_len);break;case 17:c.sym_btree=this.getOffset();c.sym_lheap=this.getOffset();this.getMetadata("debug")&&console.log("hdf5MsgSymbolTable "+c.sym_btree+" "+c.sym_lheap);break;case 21:this.hdf5MsgAttrInfo(c);
break;case 0:case 4:case 5:case 7:case 18:case 19:case 20:case 22:case 24:this.skip(a.hm_size);break;default:throw Error("Unknown message type: "+a.hm_type);}};p.prototype.hdf5V2ObjectHeader=function(a){if(!this.checkSignature("OHDR"))throw Error("Bad or missing OHDR signature");var c=this.getU8(),b=this.getU8();0!==(b&32)&&(this.getU32(),this.getU32(),this.getU32(),this.getU32());0!==(b&16)&&(this.getU16(),this.getU16());var d=this.getUXX(1<<(b&3)),e=0,f=0,g=d;for(this.getMetadata("debug")&&console.log("this.hdf5V2ObjectHeader V"+
c+" F"+b+" HS"+d);;){for(;8<=g-f;)c={},c.hm_type=this.getU8(),c.hm_size=this.getU16(),c.hm_flags=this.getU8(),this.getMetadata("debug")&&console.log("  msg"+e+" F"+c.hm_flags+" T "+c.hm_type+" S "+c.hm_size+" ("+f+"/"+g+") "+this.hdf5GetMsgName(c.hm_type)),0!==(b&4)&&(c.hm_corder=this.getU16()),d=this.tell(),this.hdf5ProcessMessage(c,a),this.seek(d+c.hm_size),f+=c.hm_size+4,e+=1;4<g-f&&this.skip(g-(f+4));this.getU32();if(0!==this._continuation_queue.length){if(c=this._continuation_queue.shift(),this.seek(c.cq_off),
g=c.cq_len-4,f=0,this.getMetadata("debug")&&console.log("continuing with "+c.cq_len+" bytes at "+this.tell()),!this.checkSignature("OCHK"))throw Error("Bad v2 object continuation");}else break}a.children.forEach(function(a,b){that.seek(a.hdr_offset);that.getMetadata("debug")&&console.log(b+" "+a.hdr_offset+" "+a.name);this.checkSignature("OHDR")?(that.seek(a.hdr_offset),that.hdf5V2ObjectHeader(a)):(that.seek(a.hdr_offset),that.hdf5V1ObjectHeader(a))})};p.prototype.loadData=function(a){var c=this;
if(0!==a.chunk_size){this.seek(a.data_offset);var b=1,d;for(d=0;d<a.dims.length;d+=1)b*=a.dims[d];b*=this.typeSize(a.type);this.getMetadata("debug")&&console.log("allocating "+b+" bytes");b=new ArrayBuffer(b);a.n_filled=0;switch(a.type){case this._type_enum.INT8:a.array=new Int8Array(b);break;case this._type_enum.UINT8:a.array=new Uint8Array(b);break;case this._type_enum.INT16:a.array=new Int16Array(b);break;case this._type_enum.UINT16:a.array=new Uint16Array(b);break;case this._type_enum.INT32:a.array=
new Int32Array(b);break;case this._type_enum.UINT32:a.array=new Uint32Array(b);break;case this._type_enum.FLT:a.array=new Float32Array(b);break;case this._type_enum.DBL:a.array=new Float64Array(b);break;default:throw Error("Illegal type: "+a.type);}this.hdf5V1BtreeNode(a)}else 0<a.data_offset&&a.data_offset<this._superblk.eof_addr?(this.getMetadata("debug")&&console.log("loading "+a.data_length+" bytes from "+a.data_offset+" to "+a.name),a.array=this.getArray(a.type,a.data_length,a.data_offset)):
this.getMetadata("debug")&&console.log("data not present for /"+a.name+"/");a.children.forEach(function(a){c.loadData(a)})};p.prototype.hdf5V1ObjectHeader=function(a){var c=this,b,d,e,f;this.startAlignment();b=this.getU8();this.skip(1);d=this.getU16();e=this.getU32();f=this.getU32();if(1!==b)throw Error("Bad v1 object header version: "+b);this.getMetadata("debug")&&console.log("this.hdf5V1ObjectHeader V"+b+" #M "+d+" RC "+e+" HS "+f);e=f;var g;for(b=0;b<d;b+=1){if(8>=e)if(0!==this._continuation_queue.length)e=
this._continuation_queue.shift(),this.seek(e.cq_off),e=e.cq_len,this.getMetadata("debug")&&console.log("continuing with "+e+" bytes at "+this.tell()),this.startAlignment();else break;this.checkAlignment();f={};f.hm_type=this.getU16();f.hm_size=this.getU16();f.hm_flags=this.getU8();if(0!==f.hm_size%8)throw Error("Size is not 8-byte aligned: "+f.hm_size);this.skip(3);e-=8+f.hm_size;this.getMetadata("debug")&&console.log("  msg"+b+" F "+f.hm_flags+" T "+f.hm_type+" S "+f.hm_size+"("+e+") "+this.hdf5GetMsgName(f.hm_type));
g=this.tell();this.hdf5ProcessMessage(f,a);this.seek(g+f.hm_size)}if(0!==a.sym_btree&&0!==a.sym_lheap){this.seek(a.sym_btree);d=this.hdf5V1BtreeNode();this.seek(a.sym_lheap);b=this.hdf5LocalHeap();for(e=0;e<d.entries_used;e+=1)this.seek(d.keys[e].child_address),this.checkSignature("SNOD")?(this.seek(d.keys[e].child_address),this.hdf5GroupSymbolTable(b,a)):(this.seek(d.keys[e].child_address),this.hdf5V1ObjectHeader(a));a.children.forEach(function(a){c.seek(a.hdr_offset);c.hdf5V1ObjectHeader(a)})}};
p.prototype.getTypeMatchMinc=function(a){return this._type_matching[a-1]};p.prototype.defined=function(a){return"undefined"!==typeof a};p.prototype.typeName=function(a){return this.defined(a)?a.constructor.name:"undefined"};p.prototype.typeSize=function(a){if(a>=this._type_enum.INT8&&a<this.type_sizes.length)return this.type_sizes[a];throw Error("Unknown type "+a);};p.prototype.typeIsFloat=function(a){return a>=this._type_enum.FLT&&a<=this._type_enum.DBL};p.prototype.join=function(a,c){var b="";if(a&&
a.length){var d;for(d=0;d<a.length-1;d+=1)b+=a[d],b+=c;b+=a[d]}return b};p.prototype.printStructure=function(a,c){var b=this,d,e="";for(d=0;d<2*c;d+=1)e+=" ";e+=a.name+(a.children.length?"/":"");0<a.type&&(e+=" "+this.typeName(a.array),a.dims.length&&(e+="["+a.dims.join(", ")+"]"),e=a.array?e+(":"+a.array.length):e+" NULL");console.log(e);Object.keys(a.attributes).forEach(function(f){var g=a.attributes[f];e="";for(d=0;d<2*c+1;d+=1)e+=" ";e+=a.name+":"+f+" "+b.typeName(g)+"["+g.length+"] ";"string"===
typeof g?e+=JSON.stringify(g):(e+="{"+b.join(g.slice(0,16),", "),16<g.length&&(e+=", ..."),e+="}");console.log(e)});a.children.forEach(function(a){b.printStructure(a,c+1)})};p.prototype.findDataset=function(a,c,b){var d=this,e;a&&a.name===c&&0<a.type?e=a:a.children.find(function(a){e=d.findDataset(a,c,b+1);return d.defined(e)});return e};p.prototype.findAttribute=function(a,c,b){var d=this,e=a.attributes[c];if(e)return e;a.children.find(function(a){e=d.findAttribute(a,c,b+1);return d.defined(e)});
return e};p.prototype.scaleVoxels=function(a,c,b,d,e){var f,g;switch(this.getTypeMatchMinc(a.type)){case "int8":f=new ArrayBuffer(a.array.length*Int8Array.BYTES_PER_ELEMENT);g=new Int8Array(f);break;case "int16":f=new ArrayBuffer(a.array.length*Int16Array.BYTES_PER_ELEMENT);g=new Int16Array(f);break;case "int32":f=new ArrayBuffer(a.array.length*Int32Array.BYTES_PER_ELEMENT);g=new Int32Array(f);break;case "float32":f=new ArrayBuffer(a.array.length*Float32Array.BYTES_PER_ELEMENT);g=new Float32Array(f);
break;case "float64":f=new ArrayBuffer(a.array.length*Float64Array.BYTES_PER_ELEMENT);g=new Float64Array(f);break;case "uint8":f=new ArrayBuffer(a.array.length*Uint8Array.BYTES_PER_ELEMENT);g=new Uint8Array(f);break;case "uint16":f=new ArrayBuffer(a.array.length*Uint16Array.BYTES_PER_ELEMENT);g=new Uint16Array(f);break;case "uint32":f=new ArrayBuffer(a.array.length*Uint32Array.BYTES_PER_ELEMENT);g=new Uint32Array(f);break;default:throw c="Unsupported data type: "+header.datatype,console.log({message:c}),
Error(c);}if(1>a.dims.length-c.dims.length)throw Error("Too few slice dimensions: "+a.dims.length+" "+c.dims.length);var h=1,r;for(r=c.dims.length;r<a.dims.length;r+=1)h*=a.dims[r];e&&console.log(h+" voxels in slice.");var l=0,m=0,p=-Number.MAX_VALUE,t=Number.MAX_VALUE,n=a.array;b=b.array;var q=c.array;e&&console.log("valid range is "+d[0]+" to "+d[1]);var y,v=d[0],x,w,u,z=this.typeIsFloat(a.type);for(r=0;r<c.array.length;r+=1)if(e&&console.log(r+" "+q[r]+" "+b[r]+" "+n[r*h]),z)for(w=0;w<h;w+=1)u=
n[m],u<d[0]||u>d[1]?g[m]=0:(g[m]=u,l+=u,u>p&&(p=u),u<t&&(t=u)),m+=1;else for(a=d[1]-d[0],y=b[r]-q[r],x=q[r],w=0;w<h;w+=1)u=(n[m]-v)/a*y+x,u=u/b[r]*d[1],g[m]=u,l+=u,m+=1,u>p&&(p=u),u<t&&(t=u);e&&(console.log("Min: "+t),console.log("Max: "+p),console.log("Sum: "+l),console.log("Mean: "+l/m));return f};p.prototype.isRgbVolume=function(a,c){var b=a.order;return"Uint8Array"===c.array.constructor.name&&0<b.length&&"vector_dimension"===b[b.length-1]&&3===a.vector_dimension.space_length};p.prototype.rgbVoxels=
function(a){a=a.array;var c=a.length,b=new ArrayBuffer(c/3*4),d=new Uint8Array(b),e,f=0;for(e=0;e<c;e+=3)d[f+0]=a[e+0],d[f+1]=a[e+1],d[f+2]=a[e+2],d[f+3]=255,f+=4;return b};p.prototype.parseHeader=function(a){var c;try{c=JSON.parse(a)}catch(b){throw a="server did not respond with valid JSON\nResponse was: \n"+a,console.log({message:a}),Error(a);}4===c.order.length&&(c.order=c.order.slice(1));c.datatype=c.datatype||"uint8";c.xspace.space_length=parseFloat(c.xspace.space_length);c.yspace.space_length=
parseFloat(c.yspace.space_length);c.zspace.space_length=parseFloat(c.zspace.space_length);c.xspace.start=parseFloat(c.xspace.start);c.yspace.start=parseFloat(c.yspace.start);c.zspace.start=parseFloat(c.zspace.start);c.xspace.step=parseFloat(c.xspace.step);c.yspace.step=parseFloat(c.yspace.step);c.zspace.step=parseFloat(c.zspace.step);c.xspace.direction_cosines=c.xspace.direction_cosines||[1,0,0];c.yspace.direction_cosines=c.yspace.direction_cosines||[0,1,0];c.zspace.direction_cosines=c.zspace.direction_cosines||
[0,0,1];c.xspace.direction_cosines=c.xspace.direction_cosines.map(parseFloat);c.yspace.direction_cosines=c.yspace.direction_cosines.map(parseFloat);c.zspace.direction_cosines=c.zspace.direction_cosines.map(parseFloat);c[c.order[0]].offset=c[c.order[1]].space_length*c[c.order[2]].space_length;c[c.order[1]].offset=c[c.order[2]].space_length;c[c.order[2]].offset=1;c.time&&(c.time.space_length=parseFloat(c.time.space_length),c.time.start=parseFloat(c.time.start),c.time.step=parseFloat(c.time.step),c.time.offset=
c.xspace.space_length*c.yspace.space_length*c.zspace.space_length);return c};p.prototype.createMincData=function(a,c){var b;switch(a.datatype){case "int8":b=new Int8Array(c);break;case "int16":b=new Int16Array(c);break;case "int32":b=new Int32Array(c);break;case "float32":b=new Float32Array(c);break;case "float64":b=new Float64Array(c);break;case "uint8":b=new Uint8Array(c);break;case "uint16":b=new Uint16Array(c);break;case "uint32":case "rgb8":b=new Uint32Array(c);break;default:throw b="Unsupported data type: "+
a.datatype,console.log({message:b}),Error(b);}return b};p.prototype._run=function(){var a=this,c=this._getInput(0);if(c){this._dv=new DataView(c);this._dv.getUint64=function(b,c){var d=a._dv.getUint32(b+0,c),e=a._dv.getUint32(b+4,c);return c?(e<<32)+d:(d<<32)+e};var b=this.createLink();try{this._superblk=this.hdf5Superblock()}catch(r){console.warn("The input file is not a Minc2 file.");return}this.seek(this._superblk.root_addr);1>=this._superblk.sbver?this.hdf5V1ObjectHeader(b):this.hdf5V2ObjectHeader(b);
this.loadData(b);this.getMetadata("debug")&&this.printStructure(b,0);c=this.findDataset(b,"image");if(!this.defined(c))throw Error("Can't find image dataset.");var d=this.findAttribute(c,"valid_range",0);if(!this.defined(d)){var e,f;switch(c.type){case this._type_enum.INT8:e=-128;f=127;break;case this._type_enum.UINT8:e=0;f=255;break;case this._type_enum.INT16:e=-32768;f=32767;break;case this._type_enum.UINT16:e=0;f=65535;break;case this._type_enum.INT32:e=2147483648;f=-2147483649;break;case this._type_enum.UINT32:e=
0,f=(1<<32)-1}d=Float32Array.of(e,f)}e=this.findDataset(b,"image-min");this.defined(e)||(e={array:Float32Array.of(0),dims:[]});f=this.findDataset(b,"image-max");this.defined(f)||(f={array:Float32Array.of(1),dims:[]});var g={},h=this.findAttribute(c,"dimorder",0);if("string"!==typeof h)throw Error("Can't find dimension order.");g.order=h.split(",");g.order.forEach(function(c){var d=a.findDataset(b,c);if(!a.defined(d))throw Error("Can't find dimension variable "+c);g[c]={};h=a.findAttribute(d,"step",
0);a.defined(h)||(h=Float32Array.of(1));g[c].step=h[0];h=a.findAttribute(d,"start",0);a.defined(h)||(h=Float32Array.of(0));g[c].start=h[0];h=a.findAttribute(d,"length",0);if(!a.defined(h))throw Error("Can't find length for "+c);g[c].space_length=h[0];h=a.findAttribute(d,"direction_cosines",0);a.defined(h)?g[c].direction_cosines=Array.prototype.slice.call(h):"xspace"===c?g[c].direction_cosines=[1,0,0]:"yspace"===c?g[c].direction_cosines=[0,1,0]:"zspace"===c&&(g[c].direction_cosines=[0,0,1])});this.isRgbVolume(g,
c)?(g.order.pop(),g.datatype="rgb8",d=this.rgbVoxels(c)):(g.datatype=this.getTypeMatchMinc(c.type),d=this.scaleVoxels(c,e,f,d,this.getMetadata("debug")));c=this.parseHeader(JSON.stringify(g));d=this.createMincData(c,d);this._addOutput(X);e=this.getOutput();e.setData(d,c);e.setMetadata("format","minc2")}else console.warn('Minc2Decoder requires an ArrayBuffer as input "0". Unable to continue.')};var ia=function(){var a;a=v.call(this)||this;a.setMetadata("debug",!1);return a};$jscomp.inherits(ia,v);
ia.prototype.parseNifti1Header=function(a){var c={order:["zspace","yspace","xspace"],xspace:{},yspace:{},zspace:{}},b=null,d=new DataView(a,0,348),e=new Uint8Array(a,0,348);a=!0;var f=d.getUint32(0,!0);348===f?a=!0:1543569408===f?a=!1:b="This does not look like a NIfTI-1 file.";f=d.getUint16(40,a);if(3>f||4<f)b="Cannot handle "+f+"-dimensional images yet.";e=String.fromCharCode.apply(null,e.subarray(344,348));"n+1\x00"!==e&&(b="Bad magic number: '"+e+"'");if(b)return console.warn("The input file is not a NIfTI file."),
null;c.xspace.space_length=d.getUint16(42,a);c.yspace.space_length=d.getUint16(44,a);c.zspace.space_length=d.getUint16(46,a);var g=d.getUint16(48,a),b=d.getUint16(70,a),h=d.getUint16(72,a),e=d.getFloat32(80,a),f=d.getFloat32(84,a),p=d.getFloat32(88,a),l=d.getFloat32(92,a),m=d.getFloat32(108,a);352>m&&(m=352);var t=d.getFloat32(112,a),u=d.getFloat32(116,a),n=d.getUint16(252,a),q=d.getUint16(254,a),y=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];1<=g&&(c.time={},c.time.space_length=g,c.time.step=l,c.time.start=
0,c.time.name="time",c.order=["time","zspace","yspace","xspace"]);c.bytes_per_voxel=h/8;c.must_swap_data=!a&&1<c.bytes_per_voxel;0<q?(y[0][0]=d.getFloat32(280,a),y[0][1]=d.getFloat32(284,a),y[0][2]=d.getFloat32(288,a),y[0][3]=d.getFloat32(292,a),y[1][0]=d.getFloat32(296,a),y[1][1]=d.getFloat32(300,a),y[1][2]=d.getFloat32(304,a),y[1][3]=d.getFloat32(308,a),y[2][0]=d.getFloat32(312,a),y[2][1]=d.getFloat32(316,a),y[2][2]=d.getFloat32(320,a),y[2][3]=d.getFloat32(324,a)):0<n?(g=d.getFloat32(256,a),h=d.getFloat32(260,
a),l=d.getFloat32(264,a),n=d.getFloat32(268,a),q=d.getFloat32(272,a),y=d.getFloat32(276,a),d=0>d.getFloat32(76,a)?-1:1,y=this.niftiQuaternToMat44(g,h,l,n,q,y,e,f,p,d)):(y[0][0]=e,y[1][1]=f,y[2][2]=p);X.transformToMinc(y,c);c.datatype=b;c.vox_offset=m;c.scl_slope=t;c.scl_inter=u;return c};ia.prototype.niftiQuaternToMat44=function(a,c,b,d,e,f,g,h,p,l){var k=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,1]],r;r=1-(a*a+c*c+b*b);1E-7>r?(r=1/Math.sqrt(a*a+c*c+b*b),a*=r,c*=r,b*=r,r=0):r=Math.sqrt(r);g=0<g?g:1;h=
0<h?h:1;p=0<p?p:1;0>l&&(p=-p);k[0][0]=(r*r+a*a-c*c-b*b)*g;k[0][1]=2*(a*c-r*b)*h;k[0][2]=2*(a*b+r*c)*p;k[1][0]=2*(a*c+r*b)*g;k[1][1]=(r*r+c*c-a*a-b*b)*h;k[1][2]=2*(c*b-r*a)*p;k[2][0]=2*(a*b-r*c)*g;k[2][1]=2*(c*b+r*a)*h;k[2][2]=(r*r+b*b-c*c-a*a)*p;k[0][3]=d;k[1][3]=e;k[2][3]=f;return k};ia.prototype.createNifti1Data=function(a,c){var b;a.must_swap_data&&X.swapn(new Uint8Array(c,a.vox_offset),a.bytes_per_voxel);switch(a.datatype){case 2:b=new Uint8Array(c,a.vox_offset);break;case 4:b=new Int16Array(c,
a.vox_offset);break;case 8:b=new Int32Array(c,a.vox_offset);break;case 16:b=new Float32Array(c,a.vox_offset);break;case 64:b=new Float64Array(c,a.vox_offset);break;case 256:b=new Int8Array(c,a.vox_offset);break;case 512:b=new Uint16Array(c,a.vox_offset);break;case 768:b=new Uint32Array(c,a.vox_offset);break;default:throw Error("Unsupported data type: "+a.datatype);}var d,e=a.scl_slope,f=a.scl_inter;if(0!==e){var g=new Float32Array(b.length);for(d=0;d<b.length;d++)g[d]=b[d]*e+f;b=g}4===a.order.length&&
(a.order=a.order.slice(1));a[a.order[0]].offset=a[a.order[1]].space_length*a[a.order[2]].space_length;a[a.order[1]].offset=a[a.order[2]].space_length;a[a.order[2]].offset=1;a.time&&(a.time.offset=a.xspace.space_length*a.yspace.space_length*a.zspace.space_length);return b};ia.prototype._run=function(){var a=this._getInput(0);if(a){var c=this.parseNifti1Header(a);if(c){a=this.createNifti1Data(c,a);this._addOutput(X);var b=this.getOutput();b.setData(a,c);b.setMetadata("format","nifti")}}else console.warn('NiftiDecoder requires an ArrayBuffer as input "0". Unable to continue.')};
var Ob=t(function(a){var c=c||function(a){if(!("undefined"===typeof a||"undefined"!==typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=a.document.createElementNS("http://www.w3.org/1999/xhtml","a"),c="download"in b,f=/constructor/i.test(a.HTMLElement)||a.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent),h=function(b){(a.setImmediate||a.setTimeout)(function(){throw b;},0)},p=function(b){setTimeout(function(){"string"===typeof b?(a.URL||a.webkitURL||a).revokeObjectURL(b):b.remove()},
4E4)},l=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a},m=function(d,e,k){k||(d=l(d));var m=this,n="application/octet-stream"===d.type,q,r=function(){for(var a=["writestart","progress","write","writeend"],a=[].concat(a),b=a.length;b--;){var c=m["on"+a[b]];if("function"===typeof c)try{c.call(m,m)}catch(Mb){h(Mb)}}};m.readyState=m.INIT;c?(q=(a.URL||a.webkitURL||a).createObjectURL(d),
setTimeout(function(){b.href=q;b.download=e;var a=new MouseEvent("click");b.dispatchEvent(a);r();p(q);m.readyState=m.DONE})):function(){if((g||n&&f)&&a.FileReader){var b=new FileReader;b.onloadend=function(){var c=g?b.result:b.result.replace(/^data:[^;]*;/,"data:attachment/file;");a.open(c,"_blank")||(a.location.href=c);m.readyState=m.DONE;r()};b.readAsDataURL(d);m.readyState=m.INIT}else q||(q=(a.URL||a.webkitURL||a).createObjectURL(d)),n?a.location.href=q:a.open(q,"_blank")||(a.location.href=q),
m.readyState=m.DONE,r(),p(q)}()},t=m.prototype;if("undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob)return function(a,b,c){b=b||a.name||"download";c||(a=l(a));return navigator.msSaveOrOpenBlob(a,b)};t.abort=function(){};t.readyState=t.INIT=0;t.WRITING=1;t.DONE=2;t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null;return function(a,b,c){return new m(a,b||a.name||"download",c)}}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||rb.content);
a.exports&&(a.exports.saveAs=c)}),ya=function(){var a;a=v.call(this)||this;a.setMetadata("filename","untitled.pixp");return a};$jscomp.inherits(ya,v);ya.prototype._hasValidInput=function(){var a=this._getInput();return a&&(a.isOfType(x.TYPE())||a.isOfType(H.TYPE()))};ya.prototype._run=function(){if(this.hasValidInput()){var a=this._getInput(),a={dataType:a.getData().constructor.name,data:Array.prototype.slice.call(a.getData()),metadata:a.getMetadataCopy(),pixpipeType:a.constructor.name},a=JSON.stringify(a),
c=new ma.Deflate({level:6,gzip:!0,header:{text:!0,time:+new Date,comment:"This file was created by Pixpipe.js"}});c.push(a,!0);this._output[0]=new Blob([c.result],{type:"application/gzip"})}else console.warn("PixpEncoder can only encode Image2D and Image3D.")};ya.prototype.download=function(){this.getOutput()?Ob.saveAs(this.getOutput(),this.getMetadata("filename")):console.warn("No output computed yet.")};var za=function(){return v.call(this)||this};$jscomp.inherits(za,v);za.prototype._hasValidInput=
function(){var a=this._getInput();return a&&a instanceof ArrayBuffer};za.prototype._run=function(){if(this.hasValidInput()){var a=this._getInput(),c=new ma.Inflate({level:6,to:"string"});c.push(a,!0);if(c.err)console.warn("This file is not a Pixp file.");else{a=null;try{a=JSON.parse(c.result)}catch(d){console.warn("Could not parse pixp file.");console.error(d);return}if(a.pixpipeType in pixpipe)if(c=window||this,c[a.dataType]){var c=new c[a.dataType](a.data),b=new pixpipe[a.pixpipeType];b.setRawData(c);
b.setRawMetadata(a.metadata);this._output[0]=b}else console.warn("Data array from pixp file is unknown: "+a.dataType);else console.warn("Unknown type pixpipe."+a.pixpipeType+", cannot create any output.")}}else console.warn("PixpDecoder can only decode ArrayBuffer.")};var Pa=function(){var a;a=v.call(this)||this;a._decoders=[p,ia,za];return a};$jscomp.inherits(Pa,v);Pa.prototype._run=function(){var a=this._getInput(0);if(a)for(var c=0;c<this._decoders.length;c++){var b=new this._decoders[c];b.addInput(a);
b.update();if(b.getNumberOfOutputs()){this._output[0]=b.getOutput();this.setMetadata("decoderConstructor",this._decoders[c]);this.setMetadata("decoderName",this._decoders[c].name);break}}else console.warn("The input buffer must not be null.")};var Fa=function(){var a;a=W.call(this)||this;a._addOutput(x);return a};$jscomp.inherits(Fa,W);Fa.prototype._run=function(){if(this.hasValidInput()){var a=this._getInput(),c=a.getWidth()*a.getHeight(),b=a.getDataCopy();this._forEachPixelOfSuch(b,0,c,1);this.getOutput().setData(b,
a.getWidth(),a.getHeight(),a.getComponentsPerPixel())}};Fa.prototype._forEachPixelOfSuch=function(a,c,b,d){if(!1 in this._events)console.warn("No function to apply per pixel was specified.");else for(var e=this._getInput(),f=e.getData(),g=e.getComponentsPerPixel(),h;c<b;c+=d){var p=c*g,l=e.get2dPositionFrom1dIndex(c);h=f.slice(p,p+g);if((h=this._events.pixel(l,h))&&h.length==g)for(l=0;l<g;l++)a[p+l]=h[l]}};var Qa=function(){var a;a=W.call(this)||this;a._inputValidator[0]=x.TYPE();a._inputValidator[1]=
x.TYPE();a._addOutput(x);return a};$jscomp.inherits(Qa,W);Qa.prototype._run=function(){if(this.hasSameSizeInput()&&this.hasValidInput()){var a=this._getInput(0),c=this._getInput(1);if(1!=c.getComponentsPerPixel())console.warn("The scaling image must have one single band.");else{for(var b=a.getWidth()*a.getHeight(),d=a.getComponentsPerPixel(),e=a.getDataCopy(),c=c.getData(),f=0;f<b;f++)for(var g=0;g<d;g++)e[f*d+g]*=c[f];this.getOutput().setData(e,a.getWidth(),a.getHeight())}}};var Pb=t(function(a,
c){(function(b,c){a.exports=c()})(rb,function(){function a(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1}function c(a,b){this.type=a;this.value=void 0!==b&&null!==b?b:0}function e(a,b){this.tokens=a;this.parser=b;this.unaryOps=b.unaryOps;this.binaryOps=b.binaryOps;this.ternaryOps=b.ternaryOps;this.functions=b.functions}function f(a){return"string"===typeof a?JSON.stringify(a).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):a}function g(a,b,d,e,f){for(var h=[],M=[],k,l,m,
K,n=0,p=a.length;n<p;n++)if(K=a[n],k=K.type,"INUMBER"===k)h.push(K);else if("IVAR"===k&&f.hasOwnProperty(K.value))K=new c("INUMBER",f[K.value]),h.push(K);else if("IOP2"===k&&1<h.length)l=h.pop(),k=h.pop(),K=d[K.value],K=new c("INUMBER",K(k.value,l.value)),h.push(K);else if("IOP3"===k&&2<h.length)m=h.pop(),l=h.pop(),k=h.pop(),"?"===K.value?h.push(k.value?l.value:m.value):(K=e[K.value],K=new c("INUMBER",K(k.value,l.value,m.value)),h.push(K));else if("IOP1"===k&&0<h.length)k=h.pop(),K=b[K.value],K=new c("INUMBER",
K(k.value)),h.push(K);else if("IEXPR"===k){for(;0<h.length;)M.push(h.shift());M.push(new c("IEXPR",g(K.value,b,d,e,f)))}else if("IMEMBER"===k&&0<h.length)k=h.pop(),h.push(new c("INUMBER",k.value[K.value]));else{for(;0<h.length;)M.push(h.shift());M.push(K)}for(;0<h.length;)M.push(h.shift());return M}function h(a,b,d){for(var e=[],f=0,g=a.length;f<g;f++){var M=a[f],k=M.type;if("IVAR"===k&&M.value===b)for(M=0;M<d.tokens.length;M++)k=d.tokens[M],k="IOP1"===k.type?Y(k.value):"IOP2"===k.type?T(k.value):
"IOP3"===k.type?ha(k.value):new c(k.type,k.value),e.push(k);else"IEXPR"===k?e.push(new c("IEXPR",h(M.value,b,d))):e.push(M)}return e}function p(a,b,c){for(var d=[],e,f,g,h,M=0,k=a.length;M<k;M++)if(h=a[M],e=h.type,"INUMBER"===e)d.push(h.value);else if("IOP2"===e)f=d.pop(),e=d.pop(),h=b.binaryOps[h.value],d.push(h(e,f));else if("IOP3"===e)g=d.pop(),f=d.pop(),e=d.pop(),"?"===h.value?d.push(p(e?f:g,b,c)):(h=b.ternaryOps[h.value],d.push(h(e,f,g)));else if("IVAR"===e)if(h.value in b.functions)d.push(b.functions[h.value]);
else if(e=c[h.value],void 0!==e)d.push(e);else throw Error("undefined variable: "+h.value);else if("IOP1"===e)e=d.pop(),h=b.unaryOps[h.value],d.push(h(e));else if("IFUNCALL"===e){h=h.value;for(e=[];0<h--;)e.unshift(d.pop());h=d.pop();if(h.apply&&h.call)d.push(h.apply(void 0,e));else throw Error(h+" is not a function");}else if("IEXPR"===e)d.push(h.value);else if("IMEMBER"===e)e=d.pop(),d.push(e[h.value]);else throw Error("invalid Expression");if(1<d.length)throw Error("invalid Expression (parity)");
return d[0]}function l(a,b){for(var c=[],d,e,h,g,M=0,k=a.length;M<k;M++)if(g=a[M],d=g.type,"INUMBER"===d)"number"===typeof g.value&&0>g.value?c.push("("+g.value+")"):c.push(f(g.value));else if("IOP2"===d)e=c.pop(),d=c.pop(),g=g.value,b?"^"===g?c.push("Math.pow("+d+", "+e+")"):"and"===g?c.push("(!!"+d+" && !!"+e+")"):"or"===g?c.push("(!!"+d+" || !!"+e+")"):"||"===g?c.push("(String("+d+") + String("+e+"))"):"=="===g?c.push("("+d+" === "+e+")"):"!="===g?c.push("("+d+" !== "+e+")"):c.push("("+d+" "+g+
" "+e+")"):c.push("("+d+" "+g+" "+e+")");else if("IOP3"===d)if(h=c.pop(),e=c.pop(),d=c.pop(),g=g.value,"?"===g)c.push("("+d+" ? "+e+" : "+h+")");else throw Error("invalid Expression");else if("IVAR"===d)c.push(g.value);else if("IOP1"===d)d=c.pop(),g=g.value,"-"===g||"+"===g?c.push("("+g+d+")"):b?"not"===g?c.push("(!"+d+")"):"!"===g?c.push("fac("+d+")"):c.push(g+"("+d+")"):"!"===g?c.push("("+d+"!)"):c.push("("+g+" "+d+")");else if("IFUNCALL"===d){e=g.value;for(d=[];0<e--;)d.unshift(c.pop());g=c.pop();
c.push(g+"("+d.join(", ")+")")}else if("IMEMBER"===d)d=c.pop(),c.push(d+"."+g.value);else if("IEXPR"===d)c.push("("+l(g.value,b)+")");else throw Error("invalid Expression");if(1<c.length)throw Error("invalid Expression (parity)");return c[0]}function m(b,c){for(var d=0,e=b.length;d<e;d++){var f=b[d];"IVAR"===f.type&&-1===a(c,f.value)?c.push(f.value):"IEXPR"===f.type&&m(f.value,c)}}function t(a,b){return Number(a)+Number(b)}function u(a,b){return a-b}function n(a,b){return a*b}function q(a,b){return a/
b}function y(a,b){return a%b}function v(a,b){return""+a+b}function w(a,b){return a===b}function x(a,b){return a!==b}function z(a,b){return a>b}function A(a,b){return a<b}function C(a,b){return a>=b}function D(a,b){return a<=b}function E(a,b){return!(!a||!b)}function G(a,b){return!(!a&&!b)}function H(a){return(Math.exp(a)-Math.exp(-a))/2}function I(a){return(Math.exp(a)+Math.exp(-a))/2}function J(a){return Infinity===a?1:-Infinity===a?-1:(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))}function F(a){return-Infinity===
a?a:Math.log(a+Math.sqrt(a*a+1))}function O(a){return Math.log(a+Math.sqrt(a*a-1))}function P(a){return Math.log((1+a)/(1-a))/2}function L(a){return Math.log(a)*Math.LOG10E}function Q(a){return-a}function U(a){return!a}function W(a){return 0>a?Math.ceil(a):Math.floor(a)}function aa(a){return Math.random()*(a||1)}function X(a){return Z(a+1)}function fa(a){return String(a).length}function ca(){for(var a=0,b=0,c=0,d=arguments.length;c<d;c++){var e=Math.abs(arguments[c]),f;b<e?(f=b/e,a=a*f*f+1,b=e):0<
e?(f=e/b,a+=f*f):a+=e}return Infinity===b?Infinity:b*Math.sqrt(a)}function da(a,b,c){return a?b:c}function Z(a){var b,c;c=a;if(isFinite(c)&&c===Math.round(c)){if(0>=a)return isFinite(a)?Infinity:NaN;if(171<a)return Infinity;c=a-2;for(--a;1<c;)a*=c,c--;0===a&&(a=1);return a}if(.5>a)return Math.PI/(Math.sin(Math.PI*a)*Z(1-a));if(171.35<=a)return Infinity;if(85<a){c=a*a;b=c*a;var d=b*a,e=d*a;return Math.sqrt(2*Math.PI/a)*Math.pow(a/Math.E,a)*(1+1/(12*a)+1/(288*c)-139/(51840*b)-571/(2488320*d)+163879/
(209018880*e)+5246819/(75246796800*e*a))}--a;c=ea[0];for(b=1;b<ea.length;++b)c+=ea[b]/(a+b);b=a+la+.5;return Math.sqrt(2*Math.PI)*Math.pow(b,a+.5)*Math.exp(-b)*c}function ga(a,b,c,d){this.type=a;this.value=b;this.line=c;this.column=d}function R(a,b,c,d,e){this.column=this.line=this.pos=0;this.current=null;this.unaryOps=b;this.binaryOps=c;this.ternaryOps=d;this.consts=e;this.expression=a;this.savedPosition=0;this.savedCurrent=null;this.savedColumn=this.savedLine=0}function Y(a){var b=ia[a];b||(b=ia[a]=
new c("IOP1",a));return b}function T(a){var b=ja[a];b||(b=ja[a]=new c("IOP2",a));return b}function ha(a){var b=ka[a];b||(b=ka[a]=new c("IOP3",a));return b}function N(a,b){this.parser=a;this.tokens=b;this.nextToken=this.current=null;this.next();this.savedNextToken=this.savedCurrent=null}function V(){this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||H,cosh:Math.cosh||I,tanh:Math.tanh||J,asinh:Math.asinh||F,acosh:Math.acosh||O,atanh:Math.atanh||
P,sqrt:Math.sqrt,log:Math.log,ln:Math.log,lg:Math.log10||L,log10:Math.log10||L,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||W,"-":Q,"+":Number,exp:Math.exp,not:U,length:fa,"!":X};this.binaryOps={"+":t,"-":u,"*":n,"/":q,"%":y,"^":Math.pow,"||":v,"==":w,"!=":x,">":z,"<":A,">=":C,"<=":D,and:E,or:G};this.ternaryOps={"?":da};this.functions={random:aa,fac:X,min:Math.min,max:Math.max,hypot:Math.hypot||ca,pyt:Math.hypot||ca,pow:Math.pow,atan2:Math.atan2,"if":da,gamma:Z};
this.consts={E:Math.E,PI:Math.PI,"true":!0,"false":!1}}c.prototype.toString=function(){switch(this.type){case "INUMBER":case "IOP1":case "IOP2":case "IOP3":case "IVAR":return this.value;case "IFUNCALL":return"CALL "+this.value;case "IMEMBER":return"."+this.value;default:return"Invalid Instruction"}};e.prototype.simplify=function(a){a=a||{};return new e(g(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,a),this.parser)};e.prototype.substitute=function(a,b){b instanceof e||(b=this.parser.parse(String(b)));
return new e(h(this.tokens,a,b),this.parser)};e.prototype.evaluate=function(a){a=a||{};return p(this.tokens,this,a)};e.prototype.toString=function(){return l(this.tokens,!1)};e.prototype.symbols=function(){var a=[];m(this.tokens,a);return a};e.prototype.variables=function(){var a=[];m(this.tokens,a);var b=this.functions;return a.filter(function(a){return!(a in b)})};e.prototype.toJSFunction=function(a,b){var c=this,d=new Function(a,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+
l(this.simplify(b).tokens,!0)+"; }");return function(){return d.apply(c,arguments)}};var la=4.7421875,ea=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3.399464998481189E-5,4.652362892704858E-5,-9.837447530487956E-5,1.580887032249125E-4,-2.1026444172410488E-4,2.1743961811521265E-4,-1.643181065367639E-4,8.441822398385275E-5,-2.6190838401581408E-5,3.6899182659531625E-6];ga.prototype.toString=function(){return this.type+": "+this.value};R.prototype.newToken=
function(a,b,c,d){return new ga(a,b,null!=c?c:this.line,null!=d?d:this.column)};R.prototype.save=function(){this.savedPosition=this.pos;this.savedCurrent=this.current;this.savedLine=this.line;this.savedColumn=this.column};R.prototype.restore=function(){this.pos=this.savedPosition;this.current=this.savedCurrent;this.line=this.savedLine;this.column=this.savedColumn};R.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken("TEOF","EOF");if(this.isWhitespace()||this.isComment())return this.next();
if(this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isComma()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')};R.prototype.isString=function(){var a=!1,b=this.line,c=this.column,d=this.pos,e=this.expression.charAt(d);if("'"===e||'"'===e){this.pos++;this.column++;for(var f=this.expression.indexOf(e,d+1);0<=f&&this.pos<this.expression.length;){this.pos=f+1;if("\\"!==this.expression.charAt(f-
1)){a=this.expression.substring(d+1,f);this.current=this.newToken("TSTRING",this.unescape(a),b,c);b=a.indexOf("\n");for(c=-1;0<=b;)this.line++,this.column=0,c=b,b=a.indexOf("\n",b+1);this.column+=a.length-c;a=!0;break}f=this.expression.indexOf(e,f+1)}}return a};R.prototype.isParen=function(){var a=this.expression.charAt(this.pos);return"("===a||")"===a?(this.current=this.newToken("TPAREN",a),this.pos++,this.column++,!0):!1};R.prototype.isComma=function(){return","===this.expression.charAt(this.pos)?
(this.current=this.newToken("TCOMMA",","),this.pos++,this.column++,!0):!1};R.prototype.isConst=function(){for(var a=this.pos,b=a;b<this.expression.length;b++){var c=this.expression.charAt(b);if(c.toUpperCase()===c.toLowerCase()&&(b===this.pos||"_"!==c&&"."!==c&&("0">c||"9"<c)))break}return b>a&&(a=this.expression.substring(a,b),a in this.consts)?(this.current=this.newToken("TNUMBER",this.consts[a]),this.pos+=a.length,this.column+=a.length,!0):!1};R.prototype.isNamedOp=function(){for(var a=this.pos,
b=a;b<this.expression.length;b++){var c=this.expression.charAt(b);if(c.toUpperCase()===c.toLowerCase()&&(b===this.pos||"_"!==c&&("0">c||"9"<c)))break}return b>a&&(a=this.expression.substring(a,b),a in this.binaryOps||a in this.unaryOps||a in this.ternaryOps)?(this.current=this.newToken("TOP",a),this.pos+=a.length,this.column+=a.length,!0):!1};R.prototype.isName=function(){for(var a=this.pos,b=a;b<this.expression.length;b++){var c=this.expression.charAt(b);if(c.toUpperCase()===c.toLowerCase()&&(b===
this.pos||"_"!==c&&("0">c||"9"<c)))break}return b>a?(a=this.expression.substring(a,b),this.current=this.newToken("TNAME",a),this.pos+=a.length,this.column+=a.length,!0):!1};R.prototype.isWhitespace=function(){for(var a=!1,b=this.expression.charAt(this.pos);" "===b||"\t"===b||"\n"===b||"\r"===b;){a=!0;this.pos++;this.column++;"\n"===b&&(this.line++,this.column=0);if(this.pos>=this.expression.length)break;b=this.expression.charAt(this.pos)}return a};var ma=/^[0-9a-f]{4}$/i;R.prototype.unescape=function(a){var b=
a.indexOf("\\");if(0>b)return a;for(var c=a.substring(0,b);0<=b;){var d=a.charAt(++b);switch(d){case "'":c+="'";break;case '"':c+='"';break;case "\\":c+="\\";break;case "/":c+="/";break;case "b":c+="\b";break;case "f":c+="\f";break;case "n":c+="\n";break;case "r":c+="\r";break;case "t":c+="\t";break;case "u":d=a.substring(b+1,b+5);ma.test(d)||this.parseError("Illegal escape sequence: \\u"+d);c+=String.fromCharCode(parseInt(d,16));b+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+
d+'"');}++b;d=a.indexOf("\\",b);c+=a.substring(b,0>d?a.length:d);b=d}return c};R.prototype.isComment=function(){if("/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)){var a=this.pos;this.pos=this.expression.indexOf("*/",this.pos)+2;1===this.pos&&(this.pos=this.expression.length);for(var a=this.expression.substring(a,this.pos),b=a.indexOf("\n");0<=b;)this.line++,this.column=a.length-b,b=a.indexOf("\n",b+1);return!0}return!1};R.prototype.isNumber=function(){for(var a=!1,
b=this.pos,c=b,d=b,e=this.column,f=e,g=!1,h=!1,k;b<this.expression.length;)if(k=this.expression.charAt(b),"0"<=k&&"9">=k||!g&&"."===k)"."===k?g=!0:h=!0,b++,e++,a=h;else break;a&&(d=b,f=e);if("e"===k||"E"===k){b++;e++;g=!0;for(h=!1;b<this.expression.length;){k=this.expression.charAt(b);if(!g||"+"!==k&&"-"!==k)if("0"<=k&&"9">=k)h=!0,g=!1;else break;else g=!1;b++;e++}h||(b=d,e=f)}a?(this.current=this.newToken("TNUMBER",parseFloat(this.expression.substring(c,b))),this.pos=b,this.column=e):(this.pos=d,
this.column=f);return a};R.prototype.isOperator=function(){var a=this.expression.charAt(this.pos);if("+"===a||"-"===a||"*"===a||"/"===a||"%"===a||"^"===a||"?"===a||":"===a||"."===a)this.current=this.newToken("TOP",a);else if("\u2219"===a||"\u2022"===a)this.current=this.newToken("TOP","*");else if(">"===a)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken("TOP",">="),this.pos++,this.column++):this.current=this.newToken("TOP",">");else if("<"===a)"="===this.expression.charAt(this.pos+
1)?(this.current=this.newToken("TOP","<="),this.pos++,this.column++):this.current=this.newToken("TOP","<");else if("|"===a)if("|"===this.expression.charAt(this.pos+1))this.current=this.newToken("TOP","||"),this.pos++,this.column++;else return!1;else if("="===a)if("="===this.expression.charAt(this.pos+1))this.current=this.newToken("TOP","=="),this.pos++,this.column++;else return!1;else if("!"===a)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken("TOP","!="),this.pos++,this.column++):
this.current=this.newToken("TOP",a);else return!1;this.pos++;this.column++;return!0};R.prototype.parseError=function(a){throw Error("parse error ["+(this.line+1)+":"+(this.column+1)+"]: "+a);};var ia={},ja={},ka={};N.prototype.next=function(){this.current=this.nextToken;return this.nextToken=this.tokens.next()};N.prototype.tokenMatches=function(b,c){return"undefined"===typeof c?!0:Array.isArray(c)?0<=a(c,b.value):"function"===typeof c?c(b):b.value===c};N.prototype.save=function(){this.savedCurrent=
this.current;this.savedNextToken=this.nextToken;this.tokens.save()};N.prototype.restore=function(){this.tokens.restore();this.current=this.savedCurrent;this.nextToken=this.savedNextToken};N.prototype.accept=function(a,b){return this.nextToken.type===a&&this.tokenMatches(this.nextToken,b)?(this.next(),!0):!1};N.prototype.expect=function(a,b){if(!this.accept(a,b))throw Error("parse error ["+this.tokens.line+":"+this.tokens.column+"]: Expected "+(b||a));};N.prototype.parseAtom=function(a){if(this.accept("TNAME"))a.push(new c("IVAR",
this.current.value));else if(this.accept("TNUMBER"))a.push(new c("INUMBER",this.current.value));else if(this.accept("TSTRING"))a.push(new c("INUMBER",this.current.value));else if(this.accept("TPAREN","("))this.parseExpression(a),this.expect("TPAREN",")");else throw Error("unexpected "+this.nextToken);};N.prototype.parseExpression=function(a){this.parseConditionalExpression(a)};N.prototype.parseConditionalExpression=function(a){for(this.parseOrExpression(a);this.accept("TOP","?");){var b=[],d=[];this.parseConditionalExpression(b);
this.expect("TOP",":");this.parseConditionalExpression(d);a.push(new c("IEXPR",b));a.push(new c("IEXPR",d));a.push(ha("?"))}};N.prototype.parseOrExpression=function(a){for(this.parseAndExpression(a);this.accept("TOP","or");)this.parseAndExpression(a),a.push(T("or"))};N.prototype.parseAndExpression=function(a){for(this.parseComparison(a);this.accept("TOP","and");)this.parseComparison(a),a.push(T("and"))};N.prototype.parseComparison=function(a){for(this.parseAddSub(a);this.accept("TOP","== != < <= >= >".split(" "));){var b=
this.current;this.parseAddSub(a);a.push(T(b.value))}};N.prototype.parseAddSub=function(a){for(this.parseTerm(a);this.accept("TOP",["+","-","||"]);){var b=this.current;this.parseTerm(a);a.push(T(b.value))}};N.prototype.parseTerm=function(a){for(this.parseFactor(a);this.accept("TOP",["*","/","%"]);){var b=this.current;this.parseFactor(a);a.push(T(b.value))}};N.prototype.parseFactor=function(a){var b=this.tokens.unaryOps;this.save();if(this.accept("TOP",function(a){return a.value in b}))if("-"!==this.current.value&&
"+"!==this.current.value&&"TPAREN"===this.nextToken.type&&"("===this.nextToken.value)this.restore(),this.parseExponential(a);else{var c=this.current;this.parseFactor(a);a.push(Y(c.value))}else this.parseExponential(a)};N.prototype.parseExponential=function(a){for(this.parsePostfixExpression(a);this.accept("TOP","^");)this.parseFactor(a),a.push(T("^"))};N.prototype.parsePostfixExpression=function(a){for(this.parseFunctionCall(a);this.accept("TOP","!");)a.push(Y("!"))};N.prototype.parseFunctionCall=
function(a){var b=this.tokens.unaryOps;if(this.accept("TOP",function(a){return a.value in b})){var d=this.current;this.parseAtom(a);a.push(Y(d.value))}else for(this.parseMemberExpression(a);this.accept("TPAREN","(");)this.accept("TPAREN",")")?a.push(new c("IFUNCALL",0)):(d=this.parseArgumentList(a),a.push(new c("IFUNCALL",d)))};N.prototype.parseArgumentList=function(a){for(var b=0;!this.accept("TPAREN",")");)for(this.parseExpression(a),++b;this.accept("TCOMMA");)this.parseExpression(a),++b;return b};
N.prototype.parseMemberExpression=function(a){for(this.parseAtom(a);this.accept("TOP",".");)this.expect("TNAME"),a.push(new c("IMEMBER",this.current.value))};V.parse=function(a){return(new V).parse(a)};V.evaluate=function(a,b){return V.parse(a).evaluate(b)};V.prototype={parse:function(a){var b=[];a=new N(this,new R(a,this.unaryOps,this.binaryOps,this.ternaryOps,this.consts));a.parseExpression(b);a.expect("TEOF","EOF");return new e(b,this)},evaluate:function(a,b){return this.parse(a).evaluate(b)}};
return{Parser:V,Expression:e}})}),Ra=function(){var a;a=W.call(this)||this;a._addOutput(x);return a};$jscomp.inherits(Ra,W);Ra.prototype._run=function(){if(!this.hasMetadata("expression"))console.warn('A filter of type ImageBlendExpressionFilter requires a blending expression.\nUse \'setMetadata("expression", "...")\' to set it.');else if(this.hasSameNcppInput()&&this.hasSameSizeInput())if(this.getNumberOfInputs()){for(var a=this.getInputCategories(),c=this._getInput(a[0]),b=c.getDataCopy(),d=(new Pb.Parser).parse(this.getMetadata("expression")),
e=0;e<b.length;e++){for(var f={},g=0;g<a.length;g++)f[a[g]]=this._getInput(a[g]).getData()[e];b[e]=d.evaluate(f)}this.getOutput().setData(b,c.getWidth(),c.getHeight())}else console.warn("A filter of type ImageBlendExpressionFilter requires at least one input.")};var Sa=function(){var a;a=W.call(this)||this;a._addOutput(x);return a};$jscomp.inherits(Sa,W);Sa.prototype._run=function(){if(this.hasSameNcppInput()&&this.hasSameSizeInput())if(this.hasInputOfCategory(0)&&this.hasInputOfCategory(1)){this.addTimeRecord("step1");
var a=this._getInput(0),c=this._getInput(1).getData();this.addTimeRecord("step1.5");var b=a.getDataCopy();this.addTimeRecord("step2");for(var d=0;d<b.length;d++)b[d]*=c[d];this.addTimeRecord("step3");this.getOutput().setData(b,a.getWidth(),a.getHeight());this.addTimeRecord("step4");this.getTime("step1","step1.5",!0);this.getTime("step1.5","step2",!0);this.getTime("step2","step3",!0);this.getTime("step3","step4",!0)}else console.warn("A filter of type MultiplyImageFilter requires 1 input of category '0' and one input of category '1'.")};
var Ta=function(){var a;a=v.call(this)||this;a._inputValidator[0]=H.TYPE();a.setMetadata("maxWidth",4096);a.setMetadata("maxHeight",4096);a.setMetadata("axis","xspace");return a};$jscomp.inherits(Ta,v);Ta.prototype._run=function(){if(this.hasValidInput()){var a=this._getInput(0),c=a.getMetadata(this.getMetadata("axis"));if(c){var b=c.space_length,d=c.width,c=c.height,e=Math.floor(this.getMetadata("maxWidth")/d),f=Math.floor(this.getMetadata("maxHeight")/c),g=e*d,h=f*c,f=e*f;1==Math.ceil(b/f)&&(h=
Math.ceil(b/e)*c);this.setMetadata("gridWidth",g/d);this.setMetadata("gridHeight",h/c);for(var p=0,l=0,m=0,t=null;l<b;l++){var u=a.getSlice(this.getMetadata("axis"),l);0==l%f&&(t=new x({width:g,height:h,color:[0]}),this._output[p]=t,m=0,p++);var n=m%e,q=Math.floor(m/e);m++;for(var n=n*d,q=q*c,v=0;v<c;v++)for(var w=0;w<d;w++)t.setPixel({x:n+w,y:q+v},u.getPixel({x:w,y:v}))}}else console.warn("Sampling axis for mosaicing was not poperly set. Has to be 'xspace', 'yspace' or 'zspace'.")}};h.PixpipeObject=
P;h.Filter=v;h.Image2D=x;h.Image3D=H;h.ImageToImageFilter=W;h.MniVolume=X;h.CanvasImageWriter=ta;h.UrlImageReader=Ca;h.FileImageReader=Da;h.FileToArrayBufferReader=xa;h.UrlToArrayBufferReader=Ea;h.Minc2Decoder=p;h.NiftiDecoder=ia;h.PixpEncoder=ya;h.PixpDecoder=za;h.Image3DGenericDecoder=Pa;h.ForEachPixelImageFilter=Fa;h.SpectralScaleImageFilter=Qa;h.ImageBlendExpressionFilter=Ra;h.MultiplyImageFilter=Sa;h.Image3DToMosaicFilter=Ta;Object.defineProperty(h,"__esModule",{value:!0})});
